GRUE.modules = JSON.parse(JSON.stringify({"modules":{"/tris/Grue/js/utils/ids":"var len=8;exports.createUID=function(e,t){var r,n,o=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";for(!t&&\"string\"==typeof e&&(t=e,e=len+1),!e&&(e=len),r=t?[t]:[],n=r.length;e>n;n++)r[n]=o.charAt(~~(62*Math.random()));return r.join(\"\")},exports.createLCUID=function(e,t){return exports.createUID(e,t).toLowerCase()},exports.createUCUID=function(e,t){return exports.createUID(e,t).toUpperCase()},exports.setDefaultUIDLength=function(e){e&&(len=e)};","/tris/Grue/js/base/Grue":"function Grue(){!this.__grue_id&&Object.defineProperty(this,\"__grue_id\",{value:createUID(idLength)}),!this.__grue_props&&Object.defineProperty(this,\"__grue_props\",{value:Object.create(null)})}var createUID=require(\"/tris/Grue/js/utils/ids\").createUID,hasOwn={}.hasOwnProperty,idLength=8;module.exports=Grue,Grue.setIDLength=function(e){e&&(idLength=e)},Grue.prototype.tap=function(e){return e.call(this),this},Grue.prototype.spawn=function(e){return!e&&(e={}),!hasOwn.call(this,\"__grue_props\")||null===typeof this.__grue_props||\"__grue_props\"in e||(e.__grue_props={value:Object.create(null),enumerable:!1}),e.__grue_id={value:createUID(),enumerable:!1},Object.create(this,e)};","/tris/Grue/js/utils/types":"for(var nativeClasses=exports.nativeClasses={\"[object Object]\":\"object\",\"[object Null]\":\"null\",\"[object Array]\":\"array\",\"[object Date]\":\"date\",\"[object String]\":\"string\",\"[object Number]\":\"number\",\"[object RegExp]\":\"regexp\",\"[object Function]\":\"function\",\"[object Undefined]\":\"undefined\",\"[object NamedNodeMap]\":\"NamedNodeMap\",\"[object NodeList]\":\"NodeList\",\"[object HTMLCollection]\":\"HTMLCollection\"},types=\"Object Array Date Number RegExp String Number Function Undefined Null\".split(\" \"),toStr={}.toString,i=0,l=types.length,type,typename;l>i;i++)type=types[i],typename=type.toLowerCase(),exports[\"is\"+type]=function(e){return nativeClasses[toStr.call(e)]==typename};\"undefined\"!=typeof GRUE&&GRUE.has(\"array_isArray\")&&(exports.isArray=Array.isArray),exports.isNaN=function(e){return null===e||+e!==+e},exports.isInt=function(e){return exports.isNaN(e)?!1:-1==(e+\"\").indexOf(\".\")},exports.isFloat=exports.isDouble=function(e){return!(null===e||+e!=+e||-1==(e+\"\").indexOf(\".\"))};","/tris/Grue/js/utils/typeOf":"var toStr={}.toString,types=require(\"/tris/Grue/js/utils/types\");module.exports=function(e){return e.__grue_class_string?e.__grue_class_string:void 0===e?\"undefined\":null===e?\"null\":\"object\"==typeof e?types.nativeClasses[toStr.call(e)]:typeof e};","/tris/Grue/js/object/mix":"var hasOwn={}.hasOwnProperty,typeOf=require(\"/tris/Grue/js/utils/typeOf\"),dontEnumBug;\"undefined\"==typeof GRUE&&(GRUE=require(\"../base/base\")),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),module.exports=function mix(e,t,r,n){var o;if(t||(t={}),\"object\"!=typeof t)throw Error(\"Insufficient arguments. Try Grue/object/copy instead.\");for(o in e)if(hasOwn.call(e,o))if((r||n)&&void 0!==t[o]){if(n)switch(typeOf(t[o])){case\"object\":mix.call(void 0,e[o],t[o]);break;case\"array\":[].push.apply(t[o],e[o]);break;default:if(r)break;t[o]=e[o]}}else t[o]=e[o];return t};","/tris/Grue/js/OO/inherit":"var mix=require(\"/tris/Grue/js/object/mix\");module.exports=Object.create?function(e,t){var r=Object.create(t.prototype);mix(e.prototype,r),e.prototype=r,e.prototype.constructor=e,e.__ctor__=t}:function(SubC,SuperC){var subProto,e;try{eval(\"var Type = function \"+(SubC.name||\"Type\")+\" () {};\")}catch(e){var Type=function(){}}Type.prototype=SuperC.prototype,subProto=new Type,mix(SubC.prototype,subProto),SubC.prototype=subProto,SubC.prototype.constructor=SubC,SubC.__ctor__=SuperC};","/tris/Grue/js/string/ucfirst":"module.exports=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};","/tris/Grue/js/infrastructure/GrueEvent":"function GrueEvent(e,t,r,o){this.type=e,this.body=null!=t?t:{},this.target=null,this.atTarget=!0,this.current=null,this.timeStamp=+new Date,this.canceled=!1,this.bubbles=r!==!1,this.defaultPrevented=!1,this.cancelable=o!==!1}module.exports=GrueEvent,GrueEvent.prototype.cancel=function(){this.cancelable&&(this.canceled=!0)},GrueEvent.prototype.preventDefault=function(){this.defaultPrevented=!0};","/tris/Grue/js/infrastructure/GruePooledEvent":"function clear(){pool.length=0}var GrueEvent=require(\"/tris/Grue/js/infrastructure/GrueEvent\"),pool=[],cleanup;module.exports=function(){var e=pool.length?pool.pop():new GrueEvent;return GrueEvent.apply(e,arguments),setTimeout(function(){100>pool.length&&pool.push(e),clearTimeout(cleanup),cleanup=setTimeout(clear,18e5)},50),e},\"undefined\"!=typeof GRUE&&(GRUE.clearGrueEventPool=clear);","/tris/Grue/js/vendor/setImmediate/setImmediate":"(function(global,undefined){\"use strict\";function canUseNextTick(){return\"object\"==typeof process&&\"[object process]\"===Object.prototype.toString.call(process)}function canUseMessageChannel(){return!!global.MessageChannel}function canUsePostMessage(){if(!global.postMessage||global.importScripts)return!1;var e=!0,t=global.onmessage;return global.onmessage=function(){e=!1},global.postMessage(\"\",\"*\"),global.onmessage=t,e}function canUseReadyStateChange(){return\"document\"in global&&\"onreadystatechange\"in global.document.createElement(\"script\")}function installNextTickImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return process.nextTick(function(){tasks.runIfPresent(e)}),e}}function installMessageChannelImplementation(e){var t=new global.MessageChannel;t.port1.onmessage=function(e){var t=e.data;tasks.runIfPresent(t)},e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return t.port2.postMessage(e),e}}function installPostMessageImplementation(e){function t(e,t){return\"string\"==typeof e&&e.substring(0,t.length)===t}function n(e){if(e.source===global&&t(e.data,r)){var n=e.data.substring(r.length);tasks.runIfPresent(n)}}var r=\"com.bn.NobleJS.setImmediate\"+Math.random();global.addEventListener?global.addEventListener(\"message\",n,!1):global.attachEvent(\"onmessage\",n),e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.postMessage(r+e,\"*\"),e}}function installReadyStateChangeImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments),t=global.document.createElement(\"script\");return t.onreadystatechange=function(){tasks.runIfPresent(e),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},global.document.documentElement.appendChild(t),e}}function installSetTimeoutImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.setTimeout(function(){tasks.runIfPresent(e)},0),e}}var tasks=function(){function Task(e,t){this.handler=e,this.args=t}Task.prototype.run=function(){if(\"function\"==typeof this.handler)this.handler.apply(undefined,this.args);else{var scriptSource=\"\"+this.handler;eval(scriptSource)}};var nextHandle=1,tasksByHandle={},currentlyRunningATask=!1;return{addFromSetImmediateArguments:function(e){var t=e[0],n=Array.prototype.slice.call(e,1),r=new Task(t,n),a=nextHandle++;return tasksByHandle[a]=r,a},runIfPresent:function(e){if(currentlyRunningATask)global.setTimeout(function(){tasks.runIfPresent(e)},0);else{var t=tasksByHandle[e];if(t){currentlyRunningATask=!0;try{t.run()}finally{delete tasksByHandle[e],currentlyRunningATask=!1}}}},remove:function(e){delete tasksByHandle[e]}}}();if(!global.setImmediate){var attachTo=\"function\"==typeof Object.getPrototypeOf&&\"setTimeout\"in Object.getPrototypeOf(global)?Object.getPrototypeOf(global):global;canUseNextTick()?installNextTickImplementation(attachTo):canUsePostMessage()?installPostMessageImplementation(attachTo):canUseMessageChannel()?installMessageChannelImplementation(attachTo):canUseReadyStateChange()?installReadyStateChangeImplementation(attachTo):installSetTimeoutImplementation(attachTo),attachTo.clearImmediate=tasks.remove}})(\"object\"==typeof global&&global?global:this);","/tris/Grue/js/infrastructure/EventEmitter":"function EventEmitter(){Grue.call(this),this.__grue_props.event_handlers=Object.create(null),this.__grue_props.use_event_pool=!1}function fire(e,t){if(!e||!e.length)return!0;for(var r=0,n=e.length;n>r;r++)!t.canceled&&e[r]&&e[r](t);return!t.canceled}module.exports=EventEmitter;var Grue=require(\"/tris/Grue/js/base/Grue\"),mix=require(\"/tris/Grue/js/object/mix\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),ucfirst=require(\"/tris/Grue/js/string/ucfirst\"),GrueEvent=require(\"/tris/Grue/js/infrastructure/GrueEvent\"),GruePooledEvent=require(\"/tris/Grue/js/infrastructure/GruePooledEvent\"),hasOwn={}.hasOwnProperty;\"undefined\"==typeof setImmediate&&require(\"/tris/Grue/js/vendor/setImmediate/setImmediate\"),inherit(EventEmitter,Grue),EventEmitter.prototype.on=function(e,t,r){var n,o=this.__grue_props.event_handlers[e]||(this.__grue_props.event_handlers[e]=[]),a=this;if(!t)throw Error(\"No callback supplied\");return n=void 0===r?t.bind(this):null===r?function(){return t.apply(void 0,arguments)}:t.bind(r),this.__grue_props.__last_hid=[e,o.length,n],this.__grue_props.__last_hid.off=function(){a.off([e,o.length,n])},o.push(n),this},EventEmitter.prototype.once=function(e,t,r){var n,o=this;return r===void 0&&(r=this),n=this.on(e,function(e){t.call(this,e),setImmediate(function(){o.off(n)})},r).lastRegisteredHandler,this},Object.defineProperty(EventEmitter.prototype,\"lastRegisteredHandler\",{get:function(){return this.__grue_props&&this.__grue_props.__last_hid},set:function(){throw Error(\"attempted to set read only property lastRegisteredHandler\")},enumerable:!0}),EventEmitter.prototype.off=function(e){var t,r,n=this.__grue_props.event_handlers;return e===void 0?(this.__grue_props.event_handlers=Object.create(null),this):(\"string\"==typeof e&&(e=[e]),t=e[0],r=e[1],t&&null==r&&n[t]?(n[t].length=0,this):(n[t][r]&&(n[t][r]=void 0),e.length=0,this))},EventEmitter.prototype.emitEvent=function(e,t,r){var n,o,a,s=!0;if(!r&&(r={}),\"string\"==typeof e?(n=e,a=new(this.__grue_props.use_event_pool?GruePooledEvent:GrueEvent)(n,t,r.canBubble,r.cancelable),a.target=this):e instanceof GrueEvent&&(a=e,n=a.type,a.atTarget&&(a.atTarget=!1)),e=null,a.current=this,s&&(s=fire(this.__grue_props.event_handlers[n],a)),!a.defaultPrevented&&(o=\"on\"+n),o&&!this[o]&&(o=\"on\"+ucfirst(n)),o&&this[o]&&(this[o](a),s=!a.canceled),s&&a.bubbles&&this._propagateEvent(a),this.__grue_props.event_handlers[\"*\"])for(var i=0;this.__grue_props.event_handlers[\"*\"].length>i;i++)this.__grue_props.event_handlers[\"*\"][i](n,a);return a=null,this},EventEmitter.prototype._propagateEvent=function(){return this},EventEmitter.augment=function(e){var t=e.constructor;if(e==Object.prototype)throw Error(\"EventEmitter#augment: Refusing to add EventEmitter instance properties to Object.prototype\");if(\"undefined\"!=typeof global&&e==global)throw Error(\"EventEmitter#augment: Refusing to add EventEmitter instance properties to the global object.\");return e.__grue_props&&e.__grue_props.event_handlers&&console.warn(\"EventEmitter#augment:\",e,\" already an event emitter.\"),e instanceof EventEmiter||e.lastRegisteredHandler!==void 0&&\"function\"==typeof e.emitEvent?e:(EventEmitter.call(e),mix(EventEmitter.prototype,e),t&&(e.constructor=t),e)},EventEmitter.prototype.spawn=function(e){var t=Grue.prototype.spawn.call(this,e);return t.__grue_props.event_handlers=Object.create(null),t};","/tris/Grue/js/object/map":"var hasOwn={}.hasOwnProperty,dontEnumBug,supportsNullProto;\"undefined\"==typeof GRUE&&(GRUE=require(\"../base/base\")),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),module.exports=function(e,t,n){var r,o,a,s=Object.create(null),i=0;if(supportsNullProto&&null===e.__proto__)for(r in e)s[r]=t.call(n,e[r],r,i++);else for(r in e)hasOwn.call(e,r)&&(s[r]=t.call(n,e[r],r,i++));if(dontEnumBug)for(o=0,a=dontEnumBug.length;a>o;o++)hasOwn.call(e,dontEnumBug[o])&&(s[dontEnumBug[o]]=t.call(n,e[dontEnumBug[o]]));return s};","/tris/Grue/js/functional/map":"var stringSupportsSubscript=GRUE.has(\"str_subscriptAccess\"),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty;module.exports=function(e,t,n){var r,o,s,a=0,u=[];if(e){if(e.length)if(o=e.length,stringSupportsSubscript||\"string\"!=typeOf(e))for(;o>a;a++)u.push(t.call(n,e[a],a,a));else for(;o>a;a++)u.push(t.call(n,e.charAt(a),a,a));else{if(supportsNullProto&&null===e.__proto__)for(o in e)u.push(t.call(n,e[o],o,a++));else for(o in e)hasOwn.call(e,o)&&u.push(t.call(n,e[o],o,a++));if(dontEnumBug)for(r=0,s=dontEnumBug.length;s>r;r++)hasOwn.call(e,dontEnumBug[r])&&u.push(t.call(n,e[dontEnumBug[r]],dontEnumBug[r],a++))}return u}};","/tris/Grue/js/number/random":"module.exports=function(e,t){return arguments.length?(1==arguments.length&&(t=e)&&(e=0),~~(Math.random()*(t-e+1))+e):Math.random()};","/tris/game/defaultPieceGenerator":"var random=require(\"/tris/Grue/js/number/random\");module.exports=function generatePieces(e,t){var n=[];for(!e&&(e=\"OITLJSZ\".split(\"\"));e.length;)n.push(e.splice(random(e.length-1),1)[0]);return t?generatePieces(n,--t):n};","/tris/game/pieces":"function eachblock(e,t,r,n,o,s){e instanceof Piece&&(s=r,o=t,t=e.x,r=e.y,n=e.r,e=e.piece);for(var i=0,a=0,u=pieces[e][n],l=!1,c=32768;!l&&c>0;c>>=1)u&c&&(l=o.call(s,t+a,r+i)),4==++a&&(a=0,++i)}function drawPiece(e,t,r,n,o,s,i){eachblock(e,t,r,s,function(t,r){drawBlock(e,t,r,n,o,i)})}function clearPiece(e,t,r,n,o,s,i){eachblock(e,t,r,s,function(e,t){clearBlock(e,t,n,o,i)})}function drawBlock(e,t,r,n,o,s){s.fillStyle=colors[e],s.fillRect(t*n,r*o,n,o);var i=.1*n,a=.1*o;s.beginPath(),s.moveTo(t*n,r*o),s.lineTo(t*n+i,r*o+a),s.lineTo(t*n+i,r*o+9*a),s.lineTo(t*n+9*i,r*o+9*a),s.lineTo(t*n+n,r*o+o),s.lineTo(t*n,r*o+o),s.lineTo(t*n,r*o),s.closePath(),s.fillStyle=\"rgba(0, 0, 0, 0.2)\",s.fill(),s.beginPath(),s.moveTo(t*n,r*o),s.lineTo(t*n+n,r*o),s.lineTo(t*n+n,r*o+o),s.lineTo(t*n+9*i,r*o+9*a),s.lineTo(t*n+9*i,r*o+a),s.lineTo(t*n+i,r*o+a),s.lineTo(t*n,r*o),s.closePath(),s.fillStyle=\"rgba(255, 255, 255, 0.5)\",s.fill()}function clearBlock(e,t,r,n,o){o.clearRect(e*r,t*n,r,n)}function Bag(e){EventEmitter.call(this),this.pieces=[],e&&(this.generator=e)}function Piece(e,t,r){EventEmitter.call(this),this._dirty=!1,this.x=3,this.y=0,this.r=0,this.dx=t,this.dy=r,this.piece=e||\"\"}var EventEmitter=require(\"/tris/Grue/js/infrastructure/EventEmitter\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),objMap=require(\"/tris/Grue/js/object/map\"),map=require(\"/tris/Grue/js/functional/map\"),oVal=parseInt([\"0000\",\"0110\",\"0110\",\"0000\"].join(\"\"),2),pieces=objMap({O:map(Array(4),function(){return oVal}),I:[[\"    \",\"####\",\"    \",\"    \"],[\"  # \",\"  # \",\"  # \",\"  # \"],[\"    \",\"    \",\"####\",\"    \"],[\" #  \",\" #  \",\" #  \",\" #  \"]],T:[[\" #  \",\"### \",\"    \",\"    \"],[\" #  \",\" ## \",\" #  \",\"    \"],[\"    \",\"### \",\" #  \",\"    \"],[\" #  \",\"##  \",\" #  \",\"    \"]],J:[[\"#   \",\"### \",\"    \",\"    \"],[\" ## \",\" #  \",\" #  \",\"    \"],[\"    \",\"### \",\"  # \",\"    \"],[\" #  \",\" #  \",\"##  \",\"    \"]],L:[[\"  # \",\"### \",\"    \",\"    \"],[\" #  \",\" #  \",\" ## \",\"    \"],[\"    \",\"### \",\"#   \",\"    \"],[\"##  \",\" #  \",\" #  \",\"    \"]],S:[[\" ## \",\"##  \",\"    \",\"    \"],[\"    \",\" #  \",\" ## \",\"  # \"],[\"    \",\" ## \",\"##  \",\"    \"],[\"#   \",\"##  \",\" #  \",\"    \"]],Z:[[\"##  \",\" ## \",\"    \",\"    \"],[\"  # \",\" ## \",\" #  \",\"    \"],[\"    \",\"##  \",\" ## \",\"    \"],[\" #  \",\"##  \",\"#   \",\"    \"]]},function(e,t){return\"O\"==t?e:e.map(function(e){return parseInt(e.join(\"\").replace(/#/g,\"1\").replace(/\\s/g,\"0\"),2)})}),colors={I:\"cyan\",O:\"yellow\",T:\"purple\",S:\"green\",Z:\"red\",J:\"blue\",L:\"orange\"},generatePieces=require(\"/tris/game/defaultPieceGenerator\");exports.pieces=pieces,exports.colors=colors,exports.eachblock=eachblock,exports.drawPiece=drawPiece,exports.clearPiece=clearPiece,exports.drawBlock=drawBlock,exports.clearBlock=clearBlock,inherit(Bag,EventEmitter),Bag.prototype.fill=function(){[].unshift.apply(this.pieces,this.generator(null,2))},Bag.prototype.generator=generatePieces,Bag.prototype.next=function(){this.pieces.length||this.fill();var e=this.pieces.pop();return this.emitEvent(\"next\",e),e},Bag.prototype.preview=function(e){return null==e&&(e=1),e>this.pieces.length&&this.fill(),this.pieces.slice(this.pieces.length-e)},Bag.prototype.reset=function(){return this.pieces.length=0,this},exports.Bag=Bag,inherit(Piece,EventEmitter),Piece.prototype.rotateLeft=function(){return this._dirty=!0,this.r?--this.r:this.r=3,this.r},Piece.prototype.rotateRight=function(){return this._dirty=!0,++this.r,this.r%=4},Piece.prototype.draw=function(e,t,r){this._dirty&&(drawPiece(this.piece,e,t,this.dx,this.dy,this.r,r),this._dirty=!1)},Piece.prototype.toString=function(){return pieces[this._piece][this.r].map(function(e,t){return!t||t%4?e?\"#\":\" \":e?\"\\n#\":\"\\n \"}).join(\"\")},exports.Piece=Piece;","/tris/Grue/js/dom/requestAnimationFramePolyfill":"\"undefined\"==typeof global&&\"undefined\"!=typeof window&&(global=window);for(var lastTime=0,vendors=[\"ms\",\"moz\",\"webkit\",\"o\"],x=0;vendors.length>x&&!global.requestAnimationFrame;++x)global.requestAnimationFrame=global[vendors[x]+\"RequestAnimationFrame\"],global.cancelAnimationFrame=global[vendors[x]+\"CancelAnimationFrame\"]||global[vendors[x]+\"CancelRequestAnimationFrame\"];global.requestAnimationFrame||(global.requestAnimationFrame=function(e){var t=+new Date,r=Math.max(0,16-(t-lastTime)),n=global.setTimeout(function(){e(t+r)},r);return lastTime=t+r,n}),global.cancelAnimationFrame||(global.cancelAnimationFrame=function(e){clearTimeout(e)}),exports.requestAnimationFrame=global.requestAnimationFrame,exports.cancelAnimationFrame=global.cancelAnimationFrame;","/tris/Grue/js/dom/anim/Ticker":"function Ticker(e,t){EventEmitter.call(this),this.__grue_props.use_event_pool=!0,this.fps=1e3/(e||60),this.last=0,this.time=0,this.playing=!1,this.skip=null!=t?1+t:2,this.requestID=0}var EventEmitter=require(\"/tris/Grue/js/infrastructure/EventEmitter\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),af=require(\"/tris/Grue/js/dom/requestAnimationFramePolyfill\"),requestAnimationFrame=af.requestAnimationFrame,cancelAnimationFrame=af.cancelAnimationFrame;module.exports=Ticker,inherit(Ticker,EventEmitter),Ticker.prototype._loop=function(e){var t=this;this.requestID=requestAnimationFrame(function(){t._loop.apply(t,arguments)});var r=e-this.last,n=this.skip;for(this.last=e,this.time+=r;this.time>this.fps&&n;)this.time-=this.fps,n-=1,this.emitEvent(\"tick\",this.fps);this.time=(this.time+1e3*this.fps)%this.fps,n!=this.skip&&this.playing&&this.emitEvent(\"draw\",this.time/this.fps)},Ticker.prototype.toggle=function(){return this[this.playing?\"stop\":\"start\"]()},Ticker.prototype.stop=function(){return this.last=0,this.time=0,this.playing=!1,this.requestID&&cancelAnimationFrame(this.requestID),this},Ticker.prototype.start=function(){var e=this;return this.playing=!0,this.requestID=requestAnimationFrame(function(){e._loop.apply(e,arguments)}),this},Ticker.prototype.destroy=function(){this.stop(),this.off(),delete this.start,delete this._loop};","/tris/Grue/js/functional/each":"var stringSupportsSubscript=GRUE.has(\"str_subscriptAccess\"),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),hasObjKeys=GRUE.has(\"obj_keys\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty;module.exports=function(e,t,r){var n,o,i,s=0;if(e)if(e.length)if(n=e.length,stringSupportsSubscript||\"string\"!=typeOf(e))for(;n>s;s++)t.call(r,e[s],s,s);else for(;n>s;s++)t.call(r,e.charAt(s),s,s);else{if(supportsNullProto&&null===e.__proto__)for(n in e)t.call(r,e[n],n,s++);else if(hasObjKeys)for(n=Object.keys(e),i=n.length;i>s;s++)t.call(r,e[n[s]],n[s],s);else for(n in e)hasOwn.call(e,n)&&t.call(r,e[n],n,s++);if(dontEnumBug)for(o=0,i=dontEnumBug.length;i>o;o++)hasOwn.call(e,dontEnumBug[o])&&t.call(r,e[dontEnumBug[o]],dontEnumBug[o],s++)}};","/tris/Grue/js/string/iter":"module.exports=function(e){var t=e.length;return{string:e,length:t,index:0,prev:null,curr:e.charAt(0),next:function(r){return!r&&(r=1),t>this.index?(this.prev=this.curr,this.index+=r,this.curr=e.charAt(this.index)):null},peek:function(t){return e.charAt(this.index+(t||1))}}};","/tris/Grue/js/functional/filter":"var stringSupportsSubscript=GRUE.has(\"str_subscriptAccess\"),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty;module.exports=function(e,t,r){var n,o,i,s=0,a=[];if(e){if(e.length)if(stringSupportsSubscript||\"string\"!=typeOf(e))for(n=e.length;n>s;s++)t.call(r,e[s],s,s)!==!1&&a.push(e[s]);else for(n=e.length;n>s;s++)t.call(r,e.charAt(s),s,s)!==!1&&a.push(e.charAt(s));else{if(supportsNullProto&&null===e.__proto__)for(n in e)t.call(r,e[n],n,s++)!==!1&&a.push(e[n]);else for(n in e)hasOwn.call(e,n)&&t.call(r,e[n],n,s++)!==!1&&a.push(e[n]);if(dontEnumBug)for(o=0,i=dontEnumBug.length;i>o;o++)hasOwn.call(e,dontEnumBug[o])&&t.call(r,e[dontEnumBug[o]],dontEnumBug[o],s++)!==!1&&a.push(e[dontEnumBug[o]])}return a}};","/tris/Grue/js/dom/isHostMethodOrProperty":"module.exports=function(e,t){return/^(?:function|object|unknown)$/.test(typeof e[t])};","/tris/Grue/js/object/copy":"var each=require(\"/tris/Grue/js/functional/each\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty,isHostProp=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\");module.exports=function(e,t){var r,n,o,i,s,a;if(null===e||\"object\"!=typeof e&&(e===!0||e===!1))return e;if(e instanceof Element||\"object\"==typeof e&&e.cloneNode)try{return e.cloneNode()}catch(u){console.warn(e,\" is not what it seems.\")}switch(t||typeOf(e)){case\"object\":return r=e.constructor&&e.constructor!=Object?new e.constructor:{},each(e,function(e,t){r[t]=e}),r;case\"array\":return e.slice(0);case\"date\":return new Date(+e);case\"string\":case\"number\":case\"boolean\":return Object(e.valueOf());case\"regexp\":return i=[\"\"+e],i[1]=i[0].slice(1,i[0].lastIndexOf(\"/\")).replace(/\\\\/,\"\\\\\\\\\"),i[2]=i[0].slice(i[0].lastIndexOf(\"/\")+1),RegExp(i[1],i[2]);case\"NodeList\":case\"nodelist\":for(n=document.createDocumentFragment(),s=0,a=e.length;a>s;s++)isHostProp(e[s],\"cloneNode\")&&n.appendChild(e[s].cloneNode());return n.childNodes;case\"HTMLCollection\":case\"htmlcollection\":for(o=document.createElement(\"div\"),s=0,a=e.length;a>s;s++)isHostProp(e[s],\"cloneNode\")&&o.appendChild(e[s].cloneNode());return o.children;default:return e}};","/tris/Grue/js/infrastructure/Observable":"function defineObservedProperty(e,t,r){Array.isArray(t[e])||types.isObject(t[e])?Object.defineProperty(this,e,{value:observe(t[e],function(t){notify.call(this,r,e,new GrueEvent(\"collectionChange\",{prop:e,oldValue:t.body.oldValue,value:t.body.value},!0,!1))})}):t[e]instanceof Function?this[e]=function(){var n=copy(t);t[e].apply(t,arguments),notify.call(this,r,e,new GrueEvent(\"functionCall\",{prop:e,oldValue:n,value:copy(t)},!0,!1))}:hasOwn.call(this,e)||Object.defineProperty(this,e,{get:function(){return t[e]},set:function(n){var o=t[e];t[e]=n,notify.call(this,r,e,new GrueEvent(e+\"Change\",{prop:e,oldValue:o,value:n},!0,!1))}})}function notify(e,t,r){for(var n=0,o=e[t]&&e[t].length||0;o>n;n++)e[t][n](r);if(e.__grue_all&&e.__grue_all.length)for(var n=0,o=e.__grue_all.length;o>n;n++)e.__grue_all[n](r)}function obFn(e,t){return observe(this,e,t),this}var ids=require(\"/tris/Grue/js/utils/ids\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),types=require(\"/tris/Grue/js/utils/types\"),filter=require(\"/tris/Grue/js/functional/filter\"),each=require(\"/tris/Grue/js/functional/each\"),copy=require(\"/tris/Grue/js/object/copy\"),GrueEvent=require(\"/tris/Grue/js/infrastructure/GrueEvent\"),hasOwn={}.hasOwnProperty,arrayProps=Object.getOwnPropertyNames(Array.prototype).filter(function(e){return\"constructor\"!=e}),proxyArrayProto=Object.create(null),observed=Object.create(null);each(arrayProps,function(e){\"function\"==typeof[][e]?this[e]=function(){var t=this.__grue_target.slice(0);[][e].apply(this.__grue_target,arguments),notify(this.__grue_observers,e,new GrueEvent(\"functionCall\",{prop:key,oldValue:t,value:this.__grue_target.slice(0)},!0,!1))}:Object.defineProperty(this,e,{get:function(){return this.__grue_target[e]},set:function(t){this.__grue_target[e]=t}})},proxyArrayProto),exports.observe=function(e,t,r){if(\"object\"!=typeof e)throw new TypeError(\"Observable.observe cannot be applied to type \"+typeOf(e)+\".\");if(Object.isFrozen&&Object.isFrozen(e))throw new TypeError(\"Cannot observe changes in frozen objects.\");var n,o=e.__grue_id||ids.createUID(),s=observed[o]||(observed[o]=Object.create(null)),i=s.observers||(s.observers=Object.create(null)),a=s.original||(s.original=e);if(n=s.proxy?s.proxy:Array.isArray(e)&&(s.proxy=Object.create(proxyArrayProto,{__grue_target:{value:e},observe:{value:obFn},__grue_observers:{value:i},__grue_id:{value:o}}))||(s.proxy=e.__grue_id?Object.create(e,{observe:{value:obFn}}):Object.create(e,{__grue_id:{value:o},observe:{value:obFn}})),!r&&t instanceof Function)if(r=t,t=null,i.__grue_all||(i.__grue_all=[]),i.__grue_all.push(r),Array.isArray(a))for(var u=0;arrayProps.length>u;u++)defineObservedProperty.call(n,arrayProps[u],a,i);else each(a,function(e){defineObservedProperty.call(n,e,a,i)});else defineObservedProperty.call(n,t,a,i),!i[t]&&(i[t]=[]),i[t].push(r);return n},exports.unObserve=function(e){var t=e.__grue_id,r=t&&observed[t]&&observed[t].original;return r?(each(observed[t].proxy,function(e,t){r.hasOwnProperty(t)||Object.defineProperty(r,t,{value:e}),delete this[t]},observed[t].proxy),each(observed[t].observers,function(e,r){delete observed[t].observers[r]}),setImmediate(function(){delete observed[t]}),r):(console.warn(\"trying to unObserve object that was not under observation.\"),e)};var observe=exports.observe;","/tris/Grue/js/array/indexOf":"module.exports=function(e,t,r,n){var o,s;if(3==arguments.length&&\"function\"==typeof r&&(n=r,r=0),o=r||0,s=e.length||0,n){for(;s>o;o++)if(n.call(e,e[o],t))return o}else for(;s>o;o++)if(e[o]===t)return o;return-1};","/tris/Grue/js/infrastructure/ComponentNode":"function ComponentNode(){Object.defineProperty(this,\"parents\",{value:[]}),Object.defineProperty(this,\"children\",{value:[]})}var indexOf=require(\"/tris/Grue/js/array/indexOf\"),filter=require(\"/tris/Grue/js/functional/filter\");ComponentNode.prototype={constructor:ComponentNode,get siblings(){var e=[],t=0;if(!this.parents||!this.parents.length)return e;for(;parents.length>t;t++)e.push.apply(e,filter(parents[t],function(e){return e!=this}),this);return e},indexOfChild:function(e){return e!=this&&this.children&&this.children.length?indexOf(this.children,e):-1},indexOfParent:function(e){return e!=this&&this.parents&&this.parents.length?indexOf(this.parents,e):-1},removeChild:function(e){var t=this.indexOfChild(e);return t>-1&&this.children.splice(t,1),this},removeParent:function(e){var t=this.indexOfParent(e);return t>-1&&this.parents.splice(t,1),this},addChild:function(e){if(e==this)throw Error(\"A node cannot be its own child\");return this.removeChild(e),this.children.push(e),e.removeParent(this),e.parents.push(this),this},addParent:function(e){if(e==this)throw Error(\"A node cannot be its own parent\");return this.removeParent(e),this.parents.push(e),e.removeChild(this),e.children.push(this),this},replaceChild:function(e,t){var r;if(e==t)return this;if(e==this||t==this)throw Error(\"Cannot add or remove node from itself\");return r=this.indexOfChild(e)>-1&&this.children.splice(r,1,t),this}},module.exports=ComponentNode;","/tris/Grue/js/infrastructure/utils/ownPropConfig":"var hasOwn={}.hasOwnProperty;module.exports=function OwnPropConfig(e){if(!(this instanceof OwnPropConfig))return new OwnPropConfig(e);var t;for(t in e)hasOwn.call(e,t)&&(this[t]=e[t])};","/tris/Grue/js/infrastructure/Component":"function Component(e){if(\"undefined\"!=typeof global&&this==global)throw Error(\"Component constructor invoked without `new`\");EventEmitter.call(this),ComponentNode.call(this),this.__grue_props._destroyed=!1,this.__init.call(this,e)}function extractFnParams(e){for(var t,r=iterStr(e),n=0,o=0,s=0,i=0,a=0;t=r.next();)if(\"/\"!=t||\"/\"!=r.peek()){if(\"/\"!=t||\"*\"!=r.peek()){if(o){if(\"(\"==t?++i:\")\"==t&&++a,i&&a&&i==a){s=r.index;break}}else if(\"s\"==t&&\"u\"==r.peek()&&\"p\"==r.peek(2)&&\"r\"==r.peek(3)){for(n=r.index,r.next(3);r.next()&&\" \"==r.curr;);if(\"(\"!=r.curr)continue;o=r.index+1,++i}}else for(;r.next();)if(\"\\\\\"!=r.prev&&\"*\"==r.curr&&\"/\"==r.peek()){r.next();break}}else for(;\"\\n\"!=r.next(););return r=null,{s:n,l:o,r:s,params:e.slice(o,s)}}function suprReplace(e,t,r){var n,o,s,i=extractFnParams(e),a=\"this.constructor.__ctor__ && this.constructor.__ctor__.prototype.\"+t+\" && this.constructor.__ctor__.prototype.\"+t+\".call(this, \";return 0==i.r?r:(n=[e.slice(0,i.s),a,i.params,e.slice(i.r)].join(\"\"),reSuper.test(n)&&(n=\"\"+suprReplace(n,t)),o=/\\(([^)]*)\\)/.exec(e)[1]||\"\",s=n.slice(n.indexOf(\"{\")+1,n.lastIndexOf(\"}\")),Function(o,s))}function stringVal(e,t){if(\"string\"==typeof e)e=/(['\"])/g.test(e)?e:'\"'+e+'\"';else if(\"number\"==typeof e||\"boolean\"==typeof e)e+=\"\";else if(null===e)e=\"null\";else if(void 0===e)e=\"undefined\";else if(\"function\"==typeof e)reSuper.test(\"\"+e)&&(e=\"\"+suprReplace(\"\"+e,t,e));else if(\"object\"==typeof e)try{e=JSON.stringify(e)}catch(r){console.warn(\"stringVal helper unable to create string representation for\",e,', recovering with \"{}\" instead. Exception:',r.message,r.stack),e=\"{}\"}return\"string\"==typeof e?e:\"''\"}var each=require(\"/tris/Grue/js/functional/each\"),mix=require(\"/tris/Grue/js/object/mix\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),iterStr=require(\"/tris/Grue/js/string/iter\"),Grue=require(\"/tris/Grue/js/base/Grue\"),EventEmitter=require(\"/tris/Grue/js/infrastructure/EventEmitter\"),Observable=require(\"/tris/Grue/js/infrastructure/Observable\"),ComponentNode=require(\"/tris/Grue/js/infrastructure/ComponentNode\"),OwnPropConfig=require(\"/tris/Grue/js/infrastructure/utils/ownPropConfig\"),hasOwn={}.hasOwnProperty,reSuper=/(?:^|\\s+)supr\\s*\\(/,protoMixin,protoPublish,prop;mix(ComponentNode.prototype,Component.prototype,!0),inherit(Component,EventEmitter),Component.prototype.isDestroyed=function(){return this.__grue_props._destroyed},Component.prototype.__init=function(e){return\"object\"!=typeof e?this:(e.publishes&&(this.publishes=Object.create(this.publishes),mix(e.publishes,this.publishes),delete e.publishes),each(e,function(e,t){var r,n;\"function\"==typeof e&&t in this&&(r=\"\"+e,reSuper.test(r)&&(n=extractFnParams(r),r=[r.slice(0,n.s),\"this.constructor.prototype.\"+t+\" && this.constructor.prototype.\"+t+\".call(this, \",n.params,r.slice(n.r)].join(\"\")),e=Function(/\\(([^)]*)\\)/.exec(r)[1],/\\{([^}]*)\\}/.exec(r)[1])),this[t]=e},this),void 0)},Component.prototype._init=function(){},Component.prototype._destroy=function(){},Component.prototype.publishes=Object.create(null),Component.prototype.destroy=function(e){if(this.on(\"destroyed\",function(e){return e.atTarget?void 0:(e.cancel(),e.preventDefault(),void 0)}),e!==!0){for(var t=0;this.children.length>t;t++)this.children[t].destroy&&this.children[t].destroy();this.children.length=0}!this.__grue_props._destroyed&&this.emitEvent(\"destroyed\"),this.__grue_props._destroyed=!0,this.off(),this.parents.length=0,this._destroy&&this._destroy()},Component.prototype.supr=function(){var e=this.constructor.prototype&&this.constructor.prototype[arguments[0]],t=[].slice.call(arguments,1);return e&&e.apply(this,t)},Component.prototype._propagateEvent=function(e){for(var t=0,r=this.parents,n=r.length;n>t&&(r[t]&&\"object\"==typeof r[t]&&r[t].emitEvent&&r[t].emitEvent(e),!e.canceled);t++);return this},module.exports=Component,protoMixin=Object.create(null),mix(Grue.prototype,protoMixin),mix(EventEmitter.prototype,protoMixin),mix(Component.prototype,protoMixin),Component.extend=function(superType,setup){var ctorBody=\"\",ctorProps=\"\",ownProps=\"\",ctorMixins,hasObservedCollection=!1,unObserveOnDestroy=[],ComponentType,argsFromConfig,ctorArgs,supProto,testInst,needsComponentMixin,prop;if(superType&&\"function\"!=typeof superType&&!setup&&(setup=superType,superType=null),!setup&&(setup={}),setup.ownProps&&each(setup.ownProps,function(e,t){var r;if(\"string\"==typeof e&&\"@proto\"==e&&setup.proto&&setup.proto[t])r=(setup.name?setup.name+\".prototype.\":\"this.constructor.prototype.\")+t;else{if(e instanceof OwnPropConfig)return\"boolean\"!=typeof e.writeable&&(e.writeable=!0),r=stringVal(e,t),ownProps+='    Object.defineProperty(this, \"'+t+'\", typeof config.'+t+' != \"undefined\" && config.'+t+\" || \"+r+\");\\n\",void 0;r=stringVal(e,t)}ownProps+=\"    this.\"+t+\" = typeof config.\"+t+' != \"undefined\" && config.'+t+\" || \"+r+\";\\n\"}),setup.name&&(ctorBody+=\"ComponentType = function \"+(setup.name||\"\")+\"(config) {\\n\"),ctorBody+=\"    !config && (config = {});\\n\",ctorBody+=ownProps,setup.observable&&(!setup.proto&&(setup.proto={}),!setup.proto.publishes&&(setup.proto.publishes={change:!0}),each(setup.observable,function(e,t){var r=stringVal(e,t),n=t+\"Change\";setup.proto.publishes[n]=!0,r&&(ctorProps+=\"    this.\"+(e&&\"object\"==typeof e?t:'__grue_props[\"'+t+'\"]')+\" = \"+r+\";\\n\"),e&&\"object\"==typeof e&&(ctorBody+=\"    this.\"+t+' = Observable.observe(this, \"'+t+'\", this.__collectionChangeHandler.bind(this));\\n',hasObservedCollection=!0,unObserveOnDestroy.push(t),delete setup.observable[t])})),superType){if(ctorBody+=\"    this.constructor.__ctor__ && this.constructor.__ctor__.\",setup.argsFromConfig){argsFromConfig=setup.argsFromConfig===!0?function(){var e=\"\"+superType,t=e.indexOf(\"(\")+1,r=e.indexOf(\")\",t);return e.slice(t,r).replace(/\\s+/g,\"\").split(\",\")}():setup.argsFromConfig,ctorArgs=[];for(var i=0,l=argsFromConfig.length;l>i;i++)ctorArgs.push(\"config.\"+argsFromConfig[i]);ctorBody+=\"call(this, \"+ctorArgs.join(\", \")+\");\\n\";for(var i=0;l>i;i++)ctorBody+=\"    delete config.\"+argsFromConfig[i]+\";\\n\"}else ctorBody+=\"apply(this, arguments);\\n\";try{testInst=new superType}catch(e){testInst={},console.warn(\"New component constructor may be invalid.\",e)}testInst instanceof Component||testInst.__init&&testInst._init&&testInst.supr&&testInst._propagateEvent&&testInst.destroy&&testInst.parents&&testInst.children&&testInst.indexOfChild&&testInst.indexOfParent&&testInst.removeChild&&testInst.removeParent&&testInst.addChild&&testInst.addParent&&testInst.replaceChild&&testInst.on&&testInst.off&&testInst.once&&testInst.emitEvent&&testInst.spawn&&testInst.tap&&testInst.__grue_id&&testInst.__grue_props||(ctorBody+=\"    Component.call(this, config);\\n\",needsComponentMixin=!0)}else ctorBody+=\"    Component.call(this, config);\\n\";if(ctorBody+=ctorProps,setup.proto&&setup.proto._init&&setup.autoInit!==!1&&(ctorBody+=setup.name?\"    \"+setup.name+\".prototype._init.apply(this, [].slice.call(arguments, 1));\\n\":\"    this._init.apply(this, [].slice.call(arguments, 1));\\n\"),hasObservedCollection&&(setup.proto.__collectionChangeHandler=function(e){this.emitEvent(e.prop,e.body),this.emitEvent(e.prop+\"Change\",e.body)},setup.proto.__unobserve=Function(\"\",\"    var list = [\"+unObserveOnDestroy+\"], i = 0, l = list.length;\\n\"+\"    for (; i < l; i++)\\n\"+\"        Observable.unObserve(this[list[i]]);\\n\"),ctorBody+='    this.on(\"destroyed\", this.__unobserve);\\n'),setup.ctorMixins&&setup.ctorMixins.length&&(ctorMixins=setup.ctorMixins.slice(0),ctorBody+=\"    this.__grue_init.call(this, config);\\n\"),setup.name?(ctorBody+=\"}\",ctorBody+=\"\\n//@ sourceURL=/ComponentCtors/\"+setup.name+\".js\",eval(ctorBody)):ComponentType=Function(\"config\",ctorBody),inherit(ComponentType,superType||Component),needsComponentMixin&&mix(protoMixin,ComponentType.prototype,!0,!1),setup.observable&&each(setup.observable,function(e,t){var r,n,o=t+\"Change\";setup.proto.publishes[o]=!0,e&&\"object\"==typeof e||(r='    var oldVal = this.__grue_props[\"'+t+'\"],\\n'+\"        evBody = {\\n\"+'            propName: \"'+t+'\",\\n'+\"            oldValue: oldVal,\\n\"+\"            value: val\\n\"+\"        };\\n\"+'    this.__grue_props[\"'+t+'\"] = val;\\n'+'    this.emitEvent(\"'+o+'\", evBody);\\n'+'    this.emitEvent(\"change\", evBody);\\n',n='    return this.__grue_props[\"'+t+'\"];\\n',Object.defineProperty(this,t,{set:Function(\"val\",r),get:Function(\"\",n)}))},ComponentType.prototype),setup.proto&&(protoPublish=setup.proto.publishes,delete setup.proto.publishes,each(setup.proto,function(e,t){if(\"function\"==typeof e){var r=\"\"+e;reSuper.test(r)&&(setup.proto[t]=suprReplace(r,t,e))}})),mix(setup.proto,ComponentType.prototype,!1,!0),ComponentType.prototype.publishes=Object.create(superType&&superType.prototype.publishes||Component.prototype.publishes),mix(protoPublish,ComponentType.prototype.publishes,!0),ctorMixins&&ctorMixins.length){Object.defineProperty(ComponentType.prototype,\"__grue_init\",{value:function(e){if(!this.__grue_props.init_done){for(var t=0,r=ctorMixins.length;r>t;t++)ctorMixins[t].call(this,e);this.__grue_props.init_done=!0}}});for(var i=0,l=ctorMixins.length;l>i;i++)mix(ctorMixins[i].prototype,ComponentType.prototype,!0,!0)}return ComponentType.prototype.constructor=ComponentType,ComponentType};","/tris/Grue/js/dom/events/isEventSupported":"function isEventSupported(e,t,r){\"boolean\"==typeof t&&(r=t,t=null),r===void 0&&(r=!1);var n,o,i,s=e&&!t;return s&&cache[+r][e]?!!cache[+r][e]:(n=t?t==window?t:t.cloneNode(!1):windowEvents[e]?window:document.createElement(TAGNAMES[e]||\"div\"),r&&!n.addEventListener?!1:(o=\"on\"+e,i=o in n,!i&&n.setAttribute&&n.removeAttribute&&(n.setAttribute(o,\"return;\"),i=\"function\"==typeof n[o],n[o]!==void 0&&(n[o]=void 0),n.removeAttribute(o)),!i&&useHasFeature&&\"wheel\"==e&&(i=document.implementation.hasFeature(\"Events.wheel\",\"3.0\")),n=null,s?cache[+r][e]=i:i))}module.exports=isEventSupported;var useHasFeature=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature(\"\",\"\")!==!0,TAGNAMES={select:\"input\",change:\"input\",submit:\"form\",reset:\"form\",error:\"img\",load:\"img\",abort:\"img\"},windowEvents={resize:!0,transitionend:!0,animationend:!0,animationstart:!0,scroll:!0,unload:!0,orientationchange:!0},cache=[{focusin:\"onfocusin\"in window,focusout:\"onfocusout\"in window},{}];","/tris/Grue/js/dom/contains":"var docEl=document&&document.documentElement;if(!docEl)throw Error(\"Grue/dom/contains requires an HTML DOM\");module.exports=\"compareDocumentPosition\"in docEl?function(e,t){return 16==(16&e.compareDocumentPosition(t))}:\"contains\"in docEl?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1};","/tris/Grue/js/dom/events/bind":"function copy(e){var t,r={};for(t in e)r[t]=e[t];return r.type=\"mouseover\"==e.type?\"mouseenter\":\"mouseleave\",r}function getHandler(e,t,r,n){var o;return o=\"mouseenter\"==t&&!has_enter||\"mouseleave\"==t&&!has_leave?function(e){var t,o=this,s=e.relatedTarget;if(!s||s!=o&&!contains(o,s)){try{t=copy(e)}catch(i){t=e}r.call(n,t)}}:function(e){r.call(n,e)}}var isHostMethodOrProperty=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\"),isEventSupported=require(\"/tris/Grue/js/dom/events/isEventSupported\"),contains=require(\"/tris/Grue/js/dom/contains\"),docEl=document&&document.documentElement,useCapture={},eventMap={},hasOwn={}.hasOwnProperty,has_focusIn,has_focusOut,has_enter,has_leave,stopPropagation,addEvent;if(!docEl)throw Error(\"DOM utilities require a DOM\");has_focusIn=isEventSupported(\"focusin\"),has_focusOut=isEventSupported(\"focusout\"),has_enter=isEventSupported(\"mouseenter\"),has_leave=isEventSupported(\"mouseleave\"),!has_focusIn&&(useCapture.focusin=!0)&&(eventMap.focusin=\"focus\"),!has_focusOut&&(useCapture.focusout=!0)&&(eventMap.focusout=\"blur\"),!has_enter&&(eventMap.mouseenter=\"mouseover\"),!has_leave&&(eventMap.mouseleave=\"mouseleave\"),isHostMethodOrProperty(docEl,\"addEventListener\")?addEvent=function(e,t,r,n){if(n===void 0&&(n=e),~t.indexOf(\" \"))return function(){for(var o,s=[e,\"\",r,n],i=t.split(\" \"),a=[],u=0;i.length>u;u++)o=s.slice(0),o[1]=i[u],a.push(addEvent.apply(void 0,o));return a}();var o=getHandler(e,t,r,n);return e.addEventListener(eventMap[t]||t,o,!!useCapture[t]),o.el=e,[eventMap[t]||t,o,!!useCapture[t]]}:isHostMethodOrProperty(docEl,\"attachEvent\")&&(\"undefined\"==typeof GRUE&&(GRUE={}),!GRUE._boundEls&&(GRUE._boundEls=[]),addEvent=function(e,t,r,n){function o(){var e,t=window.event;try{e=copy(t)}catch(o){throw console.error(o.message),o}e.defaultPrevented===void 0&&(e.defaultPrevented=!!t.returnValue),e.target===void 0&&(e.target=t.srcElement),e.stopPropagation=function(){t.cancelBubble=!0},e.preventDefault=function(){t.returnValue=!1},n===void 0&&(n=GRUE._boundEls[s]),r.call(n,e),n=null}if(useCapture[t])throw Error(\"Browser does not support capture phase\");if(~t.indexOf(\" \"))return function(){for(var o,s=[e,\"\",r,n],i=t.split(\" \"),a=[],u=0;i.length>u;u++)o=s.slice(0),o[1]=i[u],a.push(addEvent.apply(void 0,o));return a}();var s=GRUE._boundEls.length;return GRUE._boundEls.push(e),e.attachEvent(\"on\"+t,o),e=null,[\"on\"+t,o,s]}),module.exports=addEvent;","/tris/Grue/js/dom/events/unbind":"var isHostMethod=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\"),docEl=document&&document.documentElement;if(!docEl)throw Error(\"DOM utilities require a DOM\");if(isHostMethod(docEl,\"removeEventListener\"))module.exports=function(e){return e[1]&&e[1].el?(e[1].el.removeEventListener(e[0],e[1],e[2]),e.length=0,void 0):console.error(\"invalid handle passed to Grue/dom/events/unbind\")};else if(isHostMethod(docEl,\"detachEvent\")){if(\"undefined\"==typeof GRUE||GRUE._boundEls===void 0)throw Error(\"This will not work\");module.exports=function(e){GRUE._boundEls[e[2]].detachEvent(e[0],e[1]),GRUE._boundEls[e[2]]=void 0,e.length=0}}","/tris/Grue/js/base/has/qsa":"module.exports=document&&/^(?:function|object|unknown)$/.test(typeof document.querySelectorAll);","/tris/Grue/js/string/hyphenToCamel":"module.exports=function(e){return e.replace(/-(.?)/g,function(e,t){return t.toUpperCase()})};","/tris/Grue/js/dom/matches":"for(var vendors=[\"\",\"webkit-\",\"moz-\",\"ms-\",\"o-\"],div=document.createElement(\"div\"),isHostMethod=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\"),hasQSA=require(\"/tris/Grue/js/base/has/qsa\"),hyphenToCamel=require(\"/tris/Grue/js/string/hyphenToCamel\"),matches,i=0;5>i;i++)if(isHostMethod(div,hyphenToCamel(vendors[i]+\"matchesSelector\"))){matches=hyphenToCamel(vendors[i]+\"matchesSelector\");break}module.exports=matches?function(e,t){return e[matches](t)}:hasQSA?function(e,t){for(var r=document&&document.querySelectorAll(t),n=0,o=r.length;o>n;n++)if(r[n]==e)return!0;return!1}:function(){throw Error(\"matches or matchesSelector not implemented\")};","/tris/Grue/js/dom/events/DOMEvents":"function keyEventDelegateFn(){}function delegateFn(e,t){var r=e.selectors.targets,n=e.selectors.selectors;return function(o){!o&&window.event&&(o=window.event);var s,i,a=getTarget(o),u=(o.type,[]);s=a.id||a.getAttribute(\"data-gid\"),null==s||s!=a.id||e.targets[s]||(s=a.getAttribute(\"data-gid\")),null!=s&&e.targets[s]&&fire(e.targets[s],o),t===!1&&each(e.targets,function(e,t){var r;e.length&&(r=document.getElementById(t),r||(r=document.querySelector('[data-gid=\"'+t+'\"]')),r&&contains(r,a)&&fire(e,o))});for(var l=0,c=n.length;c>l;l++)if(r[n[l]]&&r[n[l]].length&&matchesSelector(a,n[l])&&[].push.apply(u,r[n[l]]),t===!1&&!matchesSelector(a,n[l])){i=document.querySelectorAll(n[l]);for(var p=0,d=i.length;d>p;p++)r[n[l]].length&&contains(i[p],a)&&[].push.apply(u,r[n[l]])}u.length&&fire(u,o)}}function getTarget(e){if(!e&&(e=\"undefined\"!=typeof window&&window.event),!e)throw Error(\"No event object\");return e.target?1==e.target.nodeType&&e.target||e.target.parentNode:e.srcElement?1==e.srcElement&&e.srcElement:e.srcElement.parentNode}function fire(e,t){for(var r=0,n=e.length;n>r;r++)e[r]&&e[r](t)}var bind=require(\"/tris/Grue/js/dom/events/bind\"),unbind=require(\"/tris/Grue/js/dom/events/unbind\"),matchesSelector=require(\"/tris/Grue/js/dom/matches\"),contains=require(\"/tris/Grue/js/dom/contains\"),ids=require(\"/tris/Grue/js/utils/ids\"),each=require(\"/tris/Grue/js/functional/each\"),windowEvents={load:!0,scroll:!0,resize:!0,orientationchange:!0},registry={};if(!document||!document.documentElement)throw Error(\"Grue/dom/events/on requires a document with a document element. use xhtml or html5 and correct markup\");\"undefined\"==typeof global&&\"undefined\"!=typeof window&&(global=window),exports.on=function(e,t,r,n,o,s){var i,a,u,l,c,p,d;if(\"function\"==typeof r&&(null!=n&&(\"boolean\"==typeof n?(\"object\"==typeof o&&(s=o),o=n):\"object\"==typeof n&&(s=n,o=!0)),n=r,r=t,\"string\"==typeof e?(t=e,e=null):t=null),o&&\"object\"==typeof o&&!s&&(s=o),o!==!1&&(o=!0),\"function\"!=typeof n)throw TypeError(\"Bad arguments passed to DOMEvents.on\");if(e&&null===t)return bind(e,r,n,s);if(null==e&&\"string\"==typeof t&&\"#\"==t.charAt(0)&&/^[^,>+~]+$/.test(selector)&&/^#[a-z-]+(\\s|$)/i.test(selector)&&(p=/\\s/.exec(t),d=p&&p.index&&t.slice(1,p.index),d&&(e=document.getElementById(d),e?t=t.slice(p.index+1):e=null)),null==e&&(e=windowEvents[r]?global:document),\"string\"==typeof t||e!=global&&e!=document||(o=!0),i=e==global?\"window\":e==document?\"document\":e.id||e.getAttribute(\"data-gid\")||e.nodeName&&e.nodeName.toLowerCase(),registry[i]||(registry[i]={}),registry[i][r]||(registry[i][r]={}),o?(registry[i][r].targeted||(registry[i][r].targeted={}),u=registry[i][r].targeted):(registry[i][r].normal||(registry[i][r].normal={}),u=registry[i][r].normal),u.targets||(u.targets={},u.selectors={targets:{},selectors:[]},u.removeAll=bind(e,r,delegateFn(u,o),module)),l=null===s?n:null==s&&\"string\"!=typeof t?function(e){n.call(t,e)}:function(e){n.call(s,e)},t){if(\"string\"==typeof t)return a=u.selectors.targets,null==a[t]&&(a[t]=[])&&u.selectors.selectors.push(t),a[t].push(l),[t,i,r,l,o];if(1!=t.nodeType)throw Error(\"DOMEvents.on cannot delegate event handling for \"+t);a=u.targets,c=t.id,!c&&(c=t.getAttribute(\"data-gid\")),c||(c=ids.createUID(),t.setAttribute(\"data-gid\",c),t=null),a[c]||(a[c]=[]),a[c].push(l)}return[c,i,r,l,o]},exports.off=function(e,t){var r,n,o,s,i=\"string\"!=typeof e&&e.length&&e;if(i){if(5>i.length)return unbind(i);if(5==i.length){if(r=i[4]?\"targeted\":\"normal\",n=registry[i[1]][i[2]][r].targets[i[0]])for(var a=0,u=n.length;u>a;a++)if(n[a]==i[3])return n.splice(a,1),i.length=0,void 0;if(n=registry[i[1]][i[2]][r].selectors.targets[i[0]])for(var a=0,u=n.length;u>a;a++)if(n[a]==i[3])return n.splice(a,1),i.length=0,void 0}return console.error(\"unable to unbind\",e,t)}if(\"string\"!=typeof e&&1==e.nodeType?o=e.id||e.getAttribute(\"data-gid\"):s=e,!t)throw Error(\"Cannot unbind \"+arguments);each(registry,function(e){e[t]&&(o?(e[t].normal.targets[o]&&e[t].normal.targets[o].length&&(e[t].normal.targets[o].length=0),e[t].targeted.targets[o]&&e[t].targeted.targets[o].length&&(e[t].targeted.targets[o].length=0)):(e[t].normal.selectors.targets[s]&&e[t].normal.selectors.targets[s].length&&(e[t].normal.selectors.targets[s].length=0),e[t].targeted.selectors.targets[s]&&e[t].targeted.selectors.targets[s].length&&(e[t].targeted.selectors.targets[s].length=0)))})},exports.destroy=function(){each(registry,function(e,t){each(e,function(t,r){t.removeAll&&unbind(t.removeAll),delete e[r]}),delete registry[t]})};","/tris/Grue/js/structures/Dict":"function Dict(){this._arr=[],this._obj=Object.create(null),Object.defineProperties(this,{_arr:{enumerable:!1},_obj:{enumerable:!1}})}module.exports=Dict;var typeOf=require(\"/tris/Grue/js/utils/typeOf\");Dict.prototype.add=function(e){if(\"string\"!=typeof e&&\"number\"!=typeof e)throw TypeError(\"Expected string or number but saw \"+typeOf(e)+\" instead\");this.contains(e)||(this._obj[e]=this._arr.length,this._arr.push(e))},Dict.prototype.remove=function(e){if(this.contains(e)){var t=this._obj[e];delete this._obj[e],this._arr.splice(t,1)}},Dict.prototype.contains=function(e){return e in this._obj},Dict.prototype.toArray=function(){return this._arr.slice(0)},Dict.prototype.sort=function(e){this._arr=this._arr.sort(e);for(var t=0,r=this._arr.length;r>t;t++)this._obj[this._arr[t]]=t},Object.defineProperty(Dict.prototype,\"length\",{get:function(){return this._arr.length},set:function(e){if(\"number\"!=typeof e)throw TypeError(\"Expected length to be a number but saw \"+typeOf(e)+\" instead\");var t=this._arr.slice(e);this._arr.length=e;for(var r=0;t.length>r;r++)delete this._obj[t[r]];return e}});","/tris/game/Board":"function Board(e,t,r,n,o){Component.apply(this),this.__grue_props.use_event_pool=!0,this.canvas=document.createElement(\"canvas\"),this.canvas.setAttribute(\"tabindex\",\"-1\"),this._ctx=this.canvas.getContext(\"2d\"),this._piece=null,this._emptyRow=null,this.ticker=e,this._actions=[],this._flashHandles=[],this.reset(t,r,n,o),Object.defineProperties(this,{_piece:{enumerable:!1},_actions:{enumerable:!1},_ctx:{enumerable:!1},_cols:{enumerable:!1},_rows:{enumerable:!1},_field:{enumerable:!1},_dx:{enumerable:!1},_dy:{enumerable:!1},_flashHandles:{enumerable:!1}})}module.exports=Board;var Component=require(\"/tris/Grue/js/infrastructure/Component\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),pieces=require(\"/tris/game/pieces\"),Dict=require(\"/tris/Grue/js/structures/Dict\"),mix=require(\"/tris/Grue/js/object/mix\"),colors=pieces.colors,eachblock=pieces.eachblock;mix({publishes:Object.create(Component.prototype.publishes,{animating:{value:!0},rowsCleared:{value:!0},outOfBounds:{value:!0}}),reset:function(e,t,r,n){this._ctx.clearRect(0,0,t*r,e*n),this._piece=new pieces.Piece(null,r,n),this._frameCt=0,this._actions.length=0,this.canvas.width=t*r,this.canvas.height=e*n,this._rows=e+2;var o,i=this._emptyRow=Array(t);for(this._cols=t,this._dx=r,this._dy=n,this._field=Array(this._rows),o=0;10>o;o++)i[o]=\"\";for(o=0;this._rows>o;o++)this._field[o]=i.slice(0)},refresh:function(){for(var e=this._dx,t=this._dy,r=this._field,n=this._ctx,o=2,i=this._cols,s=this._rows;s>o;o++)for(var a=0;i>a;a++)r[o][a]?pieces.drawBlock(r[o][a],a,o-2,e,t,n):pieces.clearBlock(a,o-2,e,t,n)},drawPiece:function(e,t){!t&&this.clearPiece(this._piece.piece,this._piece.x,this._piece.y,this._piece.r),this._piece.x=e.x,this._piece.y=e.y-2,this._piece.r=e.r,this._piece.piece=e.piece,e.y>=0&&pieces.drawPiece(this._piece.piece,this._piece.x,this._piece.y,this._dx,this._dy,this._piece.r,this._ctx)},clearPiece:function(e,t,r,n){pieces.clearPiece(e,t,r,this._dx,this._dy,n,this._ctx)},isRowFilled:function(e){for(var t=0,r=this._cols;r>t;t++)if(!this._field[e][t])return!1;return!0},maybeClearRows:function(e){var t=[],r={},n=new Dict;eachblock(e,function(e,n){r[n]||(r[n]=!0,t.push(n))});for(var o=0,i=t.length;i>o;o++)this.isRowFilled(t[o])&&n.add(t[o]);return n.length&&this.clearRows(n),n.length},clearRows:function(e){var t=e.toArray(),r=0;if(!t.length)throw Error(\"No rows to clear\");this.emitEvent(\"animating\",!0);for(var n=0;t.length>n;n++)t[n]-=2;this._flashHandles.push(this.ticker.on(\"draw\",function(){if(++r,7>r)for(var n=0;t.length>n;n++)this.fadeRow(t[n]);else{for(var n=0;this._flashHandles.length>n;n++)this.ticker.off(this._flashHandles[n]);this._flashHandles.length=0,this._removeRows(e),this.emitEvent(\"animating\",!1)}},this).lastRegisteredHandler)},fadeRow:function(e){this._ctx.fillStyle=\"rgba(255, 255, 255, 0.5)\",this._ctx.fillRect(0,e*this._dy,this._cols*this._dx,this._dy)},_removeRows:function(e){for(var t=Array(this._rows),r=this._rows,n=r;r--;){for(;e.contains(r);)--r;t[--n]=this._field[r]}for(var r=0,o=e.length;o>r;r++)t[r]=this._emptyRow.slice(0);this._field=t,this.refresh()},willIntersect:function(e){var t=null;return eachblock(e,function(r,n){return this.isCellOccupied(r,n)?(t={left:0>r||e.x<this._piece.x&&this._field[n]&&this._field[n][r],right:r>=this._cols||e.x>this._piece.x&&this._field[n]&&this._field[n][r],bottom:n>=this._rows||e.y<this._piece.y&&this._field[n][r],x:r,y:n},!0):void 0},this),t},isCellOccupied:function(e,t){return null==this._field[t]||null==this._field[t][e]?!0:this._field[t][e]},occupy:function(e){var t=!1,r=e.piece;eachblock(e,function(e,n){return 0>n||n>=this.cols?t=!0:(this._field[n][e]=r,void 0)},this),t&&this.emitEvent(\"outOfBounds\",!0)},toString:function(){return this._field.map(function(e,t){return[t].concat(e.map(function(e){return e?e:\" \"})).join(\"\")}).join(\"\\n\")}},Board.prototype),inherit(Board,Component);","/tris/game/Game":"function GameState(){this.initial=!0,this.ended=!1,this.playing=!1,this.sliding=!1,this.descending=!1,this.pieceIsNew=!0,this.rendering=!0,this.suspended=!1}function GameCounters(){this.traveled=0,this.motionless=0,this.slideFrames=0,this.softDropped=0,this.hardDropped=0}function Game(){Component.apply(this,arguments),this.layout=null,this._toggleBtn=null,this.bag=null,this.board=null,this.props=null,this.ticker=null,this.scoreCtor=null,this.previewCtor=null,this._state=new GameState,this._counters=new GameCounters,this._piecesSeen=0,this._actions=[],this.score=null,this.preview=null,this.dx=0,this.dy=0,this.piece=null,this._piece=new pieces.Piece(null,this.dx,this.dy),Object.defineProperties(this,{_toggleBtn:{enumerable:!1},_state:{enumerable:!1},_counters:{enumerable:!1},_piecesSeen:{enumerable:!1},_actions:{enumerable:!1},_piece:{enumerable:!1}})}var inherit=require(\"/tris/Grue/js/OO/inherit\"),Component=require(\"/tris/Grue/js/infrastructure/Component\"),DOMEvents=require(\"/tris/Grue/js/dom/events/DOMEvents\"),mix=require(\"/tris/Grue/js/object/mix\"),Board=require(\"/tris/game/Board\"),pieces=require(\"/tris/game/pieces\");module.exports=Game,Game.ACTIONS={LEFT:1,RIGHT:2,R_LEFT:3,R_RIGHT:4,SOFT:5,HARD:6,CLEAR:7},Object.defineProperty(Game,\"ACTIONS\",{enumerable:!1}),mix({publishes:Object.create(Component.prototype.publishes,{levelup:{value:!0},scoreChange:{value:!0},playing:{value:!0}}),reset:function(){var e=this.props;this.dx=e.cellsize_x||e.cellsize,this.dy=e.cellsize_y||e.cellsize,this._piecesSeen=0,this._actions.length=0,GameState.apply(this._state),GameCounters.apply(this._counters),this._newScoreBoard(),this._newPlayField(),this.preview.clear(),this.bag.reset().fill()},init:function(){this.reset(),this.layout.playfield.appendChild(this.board.canvas),this._toggleBtn=this.layout.root.querySelector('.meta > button[name=\"toggle\"]'),this._bindEvents(),this._bindDomEvents()},nextPiece:function(){this.piece||(this.piece=new pieces.Piece(null,this.dx,this.dy));var e=this.bag.next();pieces.Piece.call(this.piece,e,this.dx,this.dy),pieces.Piece.call(this._piece,e,this.dx,this.dy),++this._piecesSeen,GameCounters.call(this._counters),this._state.pieceIsNew=!0,this._state.descending=!0,this._state.sliding=!0,this.board.refresh(),this.board.willIntersect(this.piece)&&this.gameOver()},update:function(){if(!this._state.suspended&&!this._state.ended){var e=this.score.level>15?0:Math.floor(40*Math.log(15-this.score.level)),t=this._actions.slice(0);this._actions.length=0,this._counters.traveled+=e?10/e:1,this._state.rendering=t.length||this._counters.traveled>=1;for(var r=0;t.length>r;r++)switch(t[r]){case Game.ACTIONS.LEFT:this.maybeSlideLeft();break;case Game.ACTIONS.RIGHT:this.maybeSlideRight();break;case Game.ACTIONS.R_LEFT:this.maybeRotateRight();break;case Game.ACTIONS.R_RIGHT:this.maybeRotateLeft();break;case Game.ACTIONS.SOFT:this.maybeSlideDown(!0);break;case Game.ACTIONS.HARD:this.hardDrop();break;case Game.ACTIONS.CLEAR:return this.clearRows()}this._state.descending?this._counters.traveled>=1&&this.maybeSlideDown():this._state.sliding&&(this.piece.type==this._piece.type&&this.piece.x==this._piece.x&&this.piece.y==this._piece.y&&this.piece.r==this._piece.r?++this._counters.motionless:this._counters.motionless=0,this._piece.x=this.piece.x,this._piece.y=this.piece.y,this._piece.r=this.piece.r,!this._counters.slideFrames||this._counters.motionless>19?(this.piece.y?(this.board.occupy(this.piece),this._actions.push(Game.ACTIONS.CLEAR)):this.gameOver(),this._state.sliding=!1):--this._counters.slideFrames)}},gameOver:function(){this.togglePlay(),this._state.ended=!0,alert(\"Game Over!\")},maybeSlideLeft:function(){this._maybeSlide(!0)},maybeSlideRight:function(){this._maybeSlide(!1)},maybeSlideDown:function(e){this._state.descending&&(this._counters.traveled=0,this.maybeToggleDescent()?++this.piece.y:e&&++this._counters.softDropped)},hardDrop:function(){for(var e=0;++e,this._state.descending;)this.maybeSlideDown();--e,this._counters.hardDropped=e,this._counters.slideFrames=0},maybeRotateLeft:function(){this._maybeRotate(!0)},maybeRotateRight:function(){this._maybeRotate(!1)},_maybeSlide:function(e){e?--this.piece.x:++this.piece.x;var t=this.board.willIntersect(this.piece);t&&(e?++this.piece.x:--this.piece.x),this._state.descending||this.maybeToggleDescent()},_maybeRotate:function(e){e?this.piece.rotateLeft():this.piece.rotateRight();var t=this.board.willIntersect(this.piece);if(t){if(e){if(t.left){if(++this.piece.x,t=this.board.willIntersect(this.piece),!t)return;--this.piece.x}}else if(t.right){if(--this.piece.x,t=this.board.willIntersect(this.piece),!t)return;++this.piece.x}e?this.piece.rotateRight():this.piece.rotateLeft()}else this._state.descending||this.maybeToggleDescent()},clearRows:function(){var e=this.board.maybeClearRows(this.piece);e?this.score.set(e,this._counters.softDropped,this._counters.hardDropped):this.nextPiece()},maybeToggleDescent:function(){++this.piece.y;var e=this.board.willIntersect(this.piece);return--this.piece.y,e?this._state.descending&&(this._state.descending=!1,this._counters.slideFrames=40-2*this.score.level):this._state.descending=!0,this._state.descending},render:function(){this._state.rendering&&!this._state.ended&&(this.board.drawPiece(this.piece,this._state.pieceIsNew),this._state.pieceIsNew&&(this._state.pieceIsNew=!1))},on:function(){!this.__grue_props.dom_handles&&(this.__grue_props.dom_handles=[]);try{Component.prototype.on.apply(this,arguments)}catch(e){this.__grue_props.dom_handles.push(DOMEvents.on.apply(null,arguments))}return this},togglePlay:function(){return this._state.playing=!this._state.playing,this._state.initial&&(this.nextPiece(),this._state.initial=!1),this.ticker.toggle(),this.emitEvent(\"playing\",this._state.playing),this},newGame:function(){this.reset()},_newScoreBoard:function(){this.score&&this.score.destroy(),this.score=new this.scoreCtor,this.score.scoring=this.props.scoring,this.score.totalNode=this.layout.scoreboard.lastElementChild.lastChild,this.score.levelNode=this.layout.scoreboard.firstElementChild.lastChild,this.score.rowsNode=this.layout.scoreboard.firstElementChild.nextElementSibling.lastChild,this.score.ticker=this.ticker,this.score.init(),this.score.level=this.props.start_level},_newPlayField:function(){return this.board?this.board.reset(this.props.rows,this.props.cols,this.dx,this.dy):(this.board=new Board(this.ticker,this.props.rows,this.props.cols,this.dx,this.dy),void 0)},_bindEvents:function(){this.__grue_props.grue_handles=[],this.__grue_props.grue_handles.push(this.ticker.on(\"tick\",this.update,this).lastRegisteredHandler),this.__grue_props.grue_handles.push(this.ticker.on(\"draw\",this.render,this).lastRegisteredHandler),this.__grue_props.grue_handles.push(this.board.on(\"outOfBounds\",this.gameOver,this).lastRegisteredHandler),this.__grue_props.grue_handles.push(this.board.on(\"animating\",function(e){this._state.suspended=e.body,!e.body&&this.nextPiece()},this)),this.__grue_props.grue_handles.push(this.on(\"playing\",function(e){this._toggleBtn.innerHTML=e.body?\"Pause\":\"Play\"},this).lastRegisteredHandler)},_bindDomEvents:function(){this.__grue_props.dom_handles,this.on(this.layout.root,\"click\",function(e){var t=e.target,r=t.nodeName.toLowerCase();\"button\"==r&&(\"toggle\"==t.name?(this.togglePlay(),this.board.canvas.focus()):\"new\"==t.name?this.reset():\"options\"==t.name)},!1,this),this.on(this.layout.root,\"keydown\",function(e){if(!this._state.ended){var t=this.props.controls;if(e.target==this.board.canvas&&!this._state.initial){switch(e.preventDefault(),e.which){case t.rotate_left:this._actions.push(Game.ACTIONS.R_LEFT);break;case 38:case t.rotate_right:this._actions.push(Game.ACTIONS.R_RIGHT);break;case t.left:this._actions.push(Game.ACTIONS.LEFT);break;case t.right:this._actions.push(Game.ACTIONS.RIGHT);break;case t.soft_drop:this._actions.push(Game.ACTIONS.SOFT);break;case t.hard_drop:this._actions.push(Game.ACTIONS.HARD)}e.which==t.play_toggle&&this.togglePlay()}}},!1,this)},_unbindDomEvents:function(){var e=this.__grue_props.dom_handles;if(e){for(var t=0;e.length>t;t++)DOMEvents.off(e[t]);this.__grue_props.dom_handles.length=0,delete this.__grue_props.dom_handles}},_destroy:function(){this._unbindDomEvents(),delete this.__grue_props.dom_handles;for(var e=this.__grue_props.grue_handles,t=0;e.length>t;t++)e[t].off();this.board.destroy(),this.preview.destroy(),this.score.destroy(),this.bag.destroy(),this.ticker.destroy()}},Game.prototype),inherit(Game,Component);","/tris/game/Preview":"function Preview(){this.canvas=document.createElement(\"canvas\"),this.ctx=this.canvas.getContext(\"2d\"),this._showNextCt=1,this._h=0,this._w=0,this._bag=null,Object.defineProperties(this,{_showNextCt:{enumerable:!1},_h:{enumerable:!1},_w:{enumerable:!1},_bag:{enumerable:!1}})}var pieces=require(\"/tris/game/pieces\");module.exports=Preview,Preview.prototype={constructor:Preview,draw:function(){for(var e,t,r=this._showNextCt,n=this.bag.preview(r),i=0,s=0,o=0;r>o;o++){switch(t=e,e=n[o],s+=4,t){case\"S\":case\"Z\":case\"T\":case\"J\":case\"L\":s-=\"O\"==e||\"I\"==e?2:1;break;case\"I\":s-=\"O\"==e?2:1}t?\"O\"==t&&\"I\"==e&&(s-=1):s=\"I\"!=e&&\"O\"!=e?1:0,i=\"I\"!=e&&\"O\"!=e?.5:0,pieces.drawPiece(e,i,s,20,20,0,this.ctx)}},clear:function(){this.ctx.clearRect(0,0,this._w,this._h)}},Object.defineProperties(Preview.prototype,{bag:{get:function(){return this._bag},set:function(e){if(this._bag)throw Error(\"cannot reset bag\");this._bag=e,e.on(\"next\",function(){this.ctx.clearRect(0,0,this._w,this._h),this.draw()},this)}},showNext:{get:function(){return this._showNextCt},set:function(e){e=e>3?3:0>e?0:Math.floor(e),this._showNextCt=e},enumerable:!0},height:{get:function(){return this._h},set:function(e){this.canvas.height=this._h=e}},width:{get:function(){return this._w},set:function(e){this.canvas.width=this._w=e}}});","/tris/game/Score":"function Score(){this._level=0,this.rows=0,this.total=0,this._handles=[],this._rowsDisplayed=0,this._totalDisplayed=0,this.scoring=null,Object.defineProperties(this,{_handles:{enumerable:!1},_rowsDisplayed:{enumerable:!1},_totalDisplayed:{enumerable:!1},_level:{enumerable:!1}}),this.ticker=null,this.levelNode=null,this.rowsNode=null,this.totalNode=null}module.exports=Score;var mix=require(\"/tris/Grue/js/object/mix\");mix({set:function(e,t,r){var n=this.scoring.line_multipliers[e-1]*(this.level+1)+t+2*r;this.total+=n,this.rows+=e,1>=10*this.level/this.rows&&++this.level},init:function(){this.rowsNode.innerHTML=0,this.totalNode.innerHTML=0,this._handles.push(this.ticker.on(\"draw\",function(){this.rows>this._rowsDisplayed&&(++this._rowsDisplayed,this._rowsDisplayed>this.rows&&(this._rowsDisplayed=this.rows),this.rowsNode.innerHTML=this._rowsDisplayed),this.total>this._totalDisplayed&&(this._totalDisplayed+=10,this._totalDisplayed>this.total&&(this._totalDisplayed=this.total),this.totalNode.innerHTML=this._totalDisplayed)},this).lastRegisteredHandler)},destroy:function(){for(var e=0;this._handles.length>e;e++)this.ticker.off(this._handles[e])}},Score.prototype),Object.defineProperty(Score.prototype,\"level\",{get:function(){return this._level},set:function(e){this._level=e,this.levelNode.innerHTML=e+1}});","/tris/properties":"module.exports={controls:{rotate_left:68,rotate_right:70,left:37,right:39,soft_drop:40,hard_drop:32,play_toggle:80},scoring:{line_multipliers:[40,100,300,800],soft_drop:1,hard_drop:2},cellsize:25,cols:10,rows:20,preview:{show:3},start_level:5};","/tris/index":"var pieces=require(\"/tris/game/pieces\"),Ticker=require(\"/tris/Grue/js/dom/anim/Ticker\"),Bag=pieces.Bag,Game=require(\"/tris/game/Game\"),Preview=require(\"/tris/game/Preview\"),Score=require(\"/tris/game/Score\"),Board=require(\"/tris/game/Board\"),PROPS=require(\"/tris/properties\"),layout=function(){var e=document.getElementsByClassName(\"root\")[0];return{root:e,preview:e.getElementsByClassName(\"preview\")[0],playfield:e.getElementsByClassName(\"playfield\")[0],scoreboard:e.getElementsByClassName(\"scoreboard\")[0]}}(),ticker=new Ticker,bag=new Bag,game=new Game,preview=new Preview;preview.bag=bag,layout.preview.appendChild(preview.canvas),preview.height=200,preview.width=100,preview.showNext=3,game.layout=layout,game.props=PROPS,game.bag=bag,game.preview=preview,game.ticker=ticker,game.scoreCtor=Score,game.init();"},"__ordered":["/tris/Grue/js/utils/ids","/tris/Grue/js/base/Grue","/tris/Grue/js/utils/types","/tris/Grue/js/utils/typeOf","/tris/Grue/js/object/mix","/tris/Grue/js/OO/inherit","/tris/Grue/js/string/ucfirst","/tris/Grue/js/infrastructure/GrueEvent","/tris/Grue/js/infrastructure/GruePooledEvent","/tris/Grue/js/vendor/setImmediate/setImmediate","/tris/Grue/js/infrastructure/EventEmitter","/tris/Grue/js/object/map","/tris/Grue/js/functional/map","/tris/Grue/js/number/random","/tris/game/defaultPieceGenerator","/tris/game/pieces","/tris/Grue/js/dom/requestAnimationFramePolyfill","/tris/Grue/js/dom/anim/Ticker","/tris/Grue/js/functional/each","/tris/Grue/js/string/iter","/tris/Grue/js/functional/filter","/tris/Grue/js/dom/isHostMethodOrProperty","/tris/Grue/js/object/copy","/tris/Grue/js/infrastructure/Observable","/tris/Grue/js/array/indexOf","/tris/Grue/js/infrastructure/ComponentNode","/tris/Grue/js/infrastructure/utils/ownPropConfig","/tris/Grue/js/infrastructure/Component","/tris/Grue/js/dom/events/isEventSupported","/tris/Grue/js/dom/contains","/tris/Grue/js/dom/events/bind","/tris/Grue/js/dom/events/unbind","/tris/Grue/js/base/has/qsa","/tris/Grue/js/string/hyphenToCamel","/tris/Grue/js/dom/matches","/tris/Grue/js/dom/events/DOMEvents","/tris/Grue/js/structures/Dict","/tris/game/Board","/tris/game/Game","/tris/game/Preview","/tris/game/Score","/tris/properties","/tris/index"],"__":"/tris/index"}));