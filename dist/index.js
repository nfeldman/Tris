GRUE.modules = {"modules":{"/tris/Grue/js/utils/ids":"var len=8;exports.createUID=function(e,t){var r,n,o=\"0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ\";for(!t&&\"string\"==typeof e&&(t=e,e=len+1),!e&&(e=len),r=t?[t]:[],n=r.length;e>n;n++)r[n]=o.charAt(~~(62*Math.random()));return r.join(\"\")},exports.createLCUID=function(e,t){return exports.createUID(e,t).toLowerCase()},exports.createUCUID=function(e,t){return exports.createUID(e,t).toUpperCase()},exports.setDefaultUIDLength=function(e){e&&(len=e)};","/tris/Grue/js/base/Grue":"function Grue(){!this.__grue_id&&Object.defineProperty(this,\"__grue_id\",{value:createUID(idLength)}),!this.__grue_props&&Object.defineProperty(this,\"__grue_props\",{value:Object.create(null)})}var createUID=require(\"/tris/Grue/js/utils/ids\").createUID,hasOwn={}.hasOwnProperty,idLength=8;module.exports=Grue,Grue.setIDLength=function(e){e&&(idLength=e)},Grue.prototype.tap=function(e){return e.call(this),this},Grue.prototype.spawn=function(e){return!e&&(e={}),!hasOwn.call(this,\"__grue_props\")||null===typeof this.__grue_props||\"__grue_props\"in e||(e.__grue_props={value:Object.create(null),enumerable:!1}),e.__grue_id={value:createUID(),enumerable:!1},Object.create(this,e)};","/tris/Grue/js/utils/types":"for(var nativeClasses=exports.nativeClasses={\"[object Object]\":\"object\",\"[object Null]\":\"null\",\"[object Array]\":\"array\",\"[object Date]\":\"date\",\"[object String]\":\"string\",\"[object Number]\":\"number\",\"[object RegExp]\":\"regexp\",\"[object Function]\":\"function\",\"[object Undefined]\":\"undefined\",\"[object NamedNodeMap]\":\"NamedNodeMap\",\"[object NodeList]\":\"NodeList\",\"[object HTMLCollection]\":\"HTMLCollection\"},types=\"Object Array Date Number RegExp String Number Function Undefined Null\".split(\" \"),toStr={}.toString,i=0,l=types.length,type,typename;l>i;i++)type=types[i],typename=type.toLowerCase(),exports[\"is\"+type]=function(e){return nativeClasses[toStr.call(e)]==typename};\"undefined\"!=typeof GRUE&&GRUE.has(\"array_isArray\")&&(exports.isArray=Array.isArray),exports.isNaN=function(e){return null===e||+e!==+e},exports.isInt=function(e){return exports.isNaN(e)?!1:-1==(e+\"\").indexOf(\".\")},exports.isFloat=exports.isDouble=function(e){return!(null===e||+e!=+e||-1==(e+\"\").indexOf(\".\"))};","/tris/Grue/js/utils/typeOf":"var toStr={}.toString,types=require(\"/tris/Grue/js/utils/types\");module.exports=function(e){return void 0===e?\"undefined\":null===e?\"null\":\"object\"==typeof e?e.__grue_class_string||types.nativeClasses[toStr.call(e)]:typeof e};","/tris/Grue/js/object/mix":"var hasOwn={}.hasOwnProperty,typeOf=require(\"/tris/Grue/js/utils/typeOf\"),dontEnumBug;\"undefined\"==typeof GRUE&&(GRUE=require(\"../base/base\")),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),module.exports=function mix(e,t,r,n){var o;if(t||(t={}),\"object\"!=typeof t)throw Error(\"Insufficient arguments. Try Grue/object/copy instead.\");for(o in e)if(hasOwn.call(e,o))if((r||n)&&void 0!==t[o]){if(n)switch(typeOf(t[o])){case\"object\":mix.call(void 0,e[o],t[o],r,n);break;case\"array\":[].push.apply(t[o],e[o]);break;default:if(r)break;t[o]=e[o]}}else t[o]=e[o];return t};","/tris/Grue/js/OO/inherit":"var mix=require(\"/tris/Grue/js/object/mix\");module.exports=Object.create?function(e,t){var r=Object.create(t.prototype);mix(e.prototype,r),e.prototype=r,e.prototype.constructor=e,e.__ctor__=t}:function(SubC,SuperC){var subProto,e;try{eval(\"var Type = function \"+(SubC.name||\"Type\")+\" () {};\")}catch(e){var Type=function(){}}Type.prototype=SuperC.prototype,subProto=new Type,mix(SubC.prototype,subProto),SubC.prototype=subProto,SubC.prototype.constructor=SubC,SubC.__ctor__=SuperC};","/tris/Grue/js/string/ucfirst":"module.exports=function(e){return e.charAt(0).toUpperCase()+e.slice(1)};","/tris/Grue/js/infrastructure/GrueEvent":"function GrueEvent(e,t,r,o){return this.type=e||\"\",this.body=void 0===t?{}:t,this.target=null,this.atTarget=!0,this.current=null,this.timeStamp=+new Date,this.canceled=!1,this.bubbles=r!==!1,this.defaultPrevented=!1,this.cancelable=o!==!1,this}module.exports=GrueEvent,GrueEvent.prototype.cancel=function(){this.cancelable&&(this.canceled=!0)},GrueEvent.prototype.preventDefault=function(){this.defaultPrevented=!0};","/tris/Grue/js/infrastructure/GruePooledEvent":"function clear(){pool.length=0}for(var GrueEvent=require(\"/tris/Grue/js/infrastructure/GrueEvent\"),pool=Array(20),ptr=0,i=0;20>i;i++)pool[i]=new GrueEvent;module.exports=function(){return 19==ptr&&(ptr=0),GrueEvent.apply(pool[ptr++],arguments)},\"undefined\"!=typeof GRUE&&(GRUE.clearGrueEventPool=clear);","/tris/Grue/js/vendor/setImmediate/setImmediate":"(function(global,undefined){\"use strict\";function canUseNextTick(){return\"object\"==typeof process&&\"[object process]\"===Object.prototype.toString.call(process)}function canUseMessageChannel(){return!!global.MessageChannel}function canUsePostMessage(){if(!global.postMessage||global.importScripts)return!1;var e=!0,t=global.onmessage;return global.onmessage=function(){e=!1},global.postMessage(\"\",\"*\"),global.onmessage=t,e}function canUseReadyStateChange(){return\"document\"in global&&\"onreadystatechange\"in global.document.createElement(\"script\")}function installNextTickImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return process.nextTick(function(){tasks.runIfPresent(e)}),e}}function installMessageChannelImplementation(e){var t=new global.MessageChannel;t.port1.onmessage=function(e){var t=e.data;tasks.runIfPresent(t)},e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return t.port2.postMessage(e),e}}function installPostMessageImplementation(e){function t(e,t){return\"string\"==typeof e&&e.substring(0,t.length)===t}function n(e){if(e.source===global&&t(e.data,r)){var n=e.data.substring(r.length);tasks.runIfPresent(n)}}var r=\"com.bn.NobleJS.setImmediate\"+Math.random();global.addEventListener?global.addEventListener(\"message\",n,!1):global.attachEvent(\"onmessage\",n),e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.postMessage(r+e,\"*\"),e}}function installReadyStateChangeImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments),t=global.document.createElement(\"script\");return t.onreadystatechange=function(){tasks.runIfPresent(e),t.onreadystatechange=null,t.parentNode.removeChild(t),t=null},global.document.documentElement.appendChild(t),e}}function installSetTimeoutImplementation(e){e.setImmediate=function(){var e=tasks.addFromSetImmediateArguments(arguments);return global.setTimeout(function(){tasks.runIfPresent(e)},0),e}}var tasks=function(){function Task(e,t){this.handler=e,this.args=t}Task.prototype.run=function(){if(\"function\"==typeof this.handler)this.handler.apply(undefined,this.args);else{var scriptSource=\"\"+this.handler;eval(scriptSource)}};var nextHandle=1,tasksByHandle={},currentlyRunningATask=!1;return{addFromSetImmediateArguments:function(e){var t=e[0],n=Array.prototype.slice.call(e,1),r=new Task(t,n),a=nextHandle++;return tasksByHandle[a]=r,a},runIfPresent:function(e){if(currentlyRunningATask)global.setTimeout(function(){tasks.runIfPresent(e)},0);else{var t=tasksByHandle[e];if(t){currentlyRunningATask=!0;try{t.run()}finally{delete tasksByHandle[e],currentlyRunningATask=!1}}}},remove:function(e){delete tasksByHandle[e]}}}();if(!global.setImmediate){var attachTo=\"function\"==typeof Object.getPrototypeOf&&\"setTimeout\"in Object.getPrototypeOf(global)?Object.getPrototypeOf(global):global;canUseNextTick()?installNextTickImplementation(attachTo):canUsePostMessage()?installPostMessageImplementation(attachTo):canUseMessageChannel()?installMessageChannelImplementation(attachTo):canUseReadyStateChange()?installReadyStateChangeImplementation(attachTo):installSetTimeoutImplementation(attachTo),attachTo.clearImmediate=tasks.remove}})(\"object\"==typeof global&&global?global:this);","/tris/Grue/js/infrastructure/EventEmitter":"function EventEmitter(){Grue.call(this),this.__grue_props.event_handlers=Object.create(null),this.__grue_props.use_event_pool=!1}function fire(e,t){if(!e||!e.length)return!0;for(var r=0,n=e.length;n>r;r++)!t.canceled&&e[r]&&e[r](t);return!t.canceled}module.exports=EventEmitter;var Grue=require(\"/tris/Grue/js/base/Grue\"),mix=require(\"/tris/Grue/js/object/mix\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),ucfirst=require(\"/tris/Grue/js/string/ucfirst\"),GrueEvent=require(\"/tris/Grue/js/infrastructure/GrueEvent\"),GruePooledEvent=require(\"/tris/Grue/js/infrastructure/GruePooledEvent\"),hasOwn={}.hasOwnProperty;\"undefined\"==typeof setImmediate&&require(\"/tris/Grue/js/vendor/setImmediate/setImmediate\"),inherit(EventEmitter,Grue),EventEmitter.prototype.on=function(e,t,r){var n,o,s=this.__grue_props.event_handlers[e]||(this.__grue_props.event_handlers[e]=[]),a=this;if(!t)throw Error(\"No callback supplied\");return n=void 0===r?t.bind(this):null===r?function(){return t.apply(void 0,arguments)}:t.bind(r),o=this.__grue_props.__last_hid=[e,s.length,n],this.__grue_props.__last_hid.off=function(){a.off(o),delete o.off},s.push(n),this},EventEmitter.prototype.once=function(e,t,r){var n,o=this;return r===void 0&&(r=this),n=this.on(e,function(e){t.call(this,e),setImmediate(function(){o.off(n)})},r).lastRegisteredHandler,this},Object.defineProperty(EventEmitter.prototype,\"lastRegisteredHandler\",{get:function(){return this.__grue_props&&this.__grue_props.__last_hid},set:function(){throw Error(\"attempted to set read only property lastRegisteredHandler\")},enumerable:!0}),EventEmitter.prototype.off=function(e){var t,r,n=this.__grue_props.event_handlers;return e===void 0?(this.__grue_props.event_handlers=Object.create(null),this):(\"string\"==typeof e&&(e=[e]),t=e[0],r=e[1],t&&null==r&&n[t]?(n[t].length=0,this):(n[t][r]&&(n[t][r]=void 0),e.length=0,this))},EventEmitter.prototype.emitEvent=function(e,t,r){var n,o,s,a=!0;if(\"string\"==typeof e?(n=e,s=new(this.__grue_props.use_event_pool?GruePooledEvent:GrueEvent)(n,t,r?r.canBubble:void 0,r?r.cancelable:void 0),s.target=this):e instanceof GrueEvent&&(s=e,n=s.type,s.atTarget&&(s.atTarget=!1)),e=null,s.current=this,a&&(a=fire(this.__grue_props.event_handlers[n],s)),!s.defaultPrevented&&(o=\"on\"+n),o&&!this[o]&&(o=\"on\"+ucfirst(n)),o&&this[o]&&(this[o](s),a=!s.canceled),a&&s.bubbles&&this._propagateEvent(s),this.__grue_props.event_handlers[\"*\"])for(var i=0;this.__grue_props.event_handlers[\"*\"].length>i;i++)this.__grue_props.event_handlers[\"*\"][i](n,s);return s=null,this},EventEmitter.prototype._propagateEvent=function(){return this},EventEmitter.augment=function(e){var t=e.constructor;if(e==Object.prototype)throw Error(\"EventEmitter#augment: Refusing to add EventEmitter instance properties to Object.prototype\");if(\"undefined\"!=typeof global&&e==global)throw Error(\"EventEmitter#augment: Refusing to add EventEmitter instance properties to the global object.\");return e.__grue_props&&e.__grue_props.event_handlers&&console.warn(\"EventEmitter#augment:\",e,\" already an event emitter.\"),e instanceof EventEmiter||e.lastRegisteredHandler!==void 0&&\"function\"==typeof e.emitEvent?e:(EventEmitter.call(e),mix(EventEmitter.prototype,e),t&&(e.constructor=t),e)},EventEmitter.prototype.spawn=function(e){var t=Grue.prototype.spawn.call(this,e);return t.__grue_props.event_handlers=Object.create(null),t};","/tris/Grue/js/number/random":"module.exports=function(e,t){return arguments.length?(1==arguments.length&&(t=e)&&(e=0),~~(Math.random()*(t-e+1))+e):Math.random()};","/tris/Grue/js/object/map":"var hasOwn={}.hasOwnProperty,dontEnumBug,supportsNullProto;\"undefined\"==typeof GRUE&&(GRUE=require(\"../base/base\")),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),module.exports=function(e,t,r){var n,o,a,s=Object.create(null),i=0;if(supportsNullProto&&null===e.__proto__)for(n in e)s[n]=t.call(r,e[n],n,i++);else for(n in e)hasOwn.call(e,n)&&(s[n]=t.call(r,e[n],n,i++));if(dontEnumBug)for(o=0,a=dontEnumBug.length;a>o;o++)hasOwn.call(e,dontEnumBug[o])&&(s[dontEnumBug[o]]=t.call(r,e[dontEnumBug[o]]));return s};","/tris/Grue/js/functional/map":"var stringSupportsSubscript=GRUE.has(\"str_subscriptAccess\"),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty;module.exports=function(e,t,r){var n,o,s,a=0,u=[];if(e){if(e.length)if(o=e.length,stringSupportsSubscript||\"string\"!=typeOf(e))for(;o>a;a++)u.push(t.call(r,e[a],a,a));else for(;o>a;a++)u.push(t.call(r,e.charAt(a),a,a));else{if(supportsNullProto&&null===e.__proto__)for(o in e)u.push(t.call(r,e[o],o,a++));else for(o in e)hasOwn.call(e,o)&&u.push(t.call(r,e[o],o,a++));if(dontEnumBug)for(n=0,s=dontEnumBug.length;s>n;n++)hasOwn.call(e,dontEnumBug[n])&&u.push(t.call(r,e[dontEnumBug[n]],dontEnumBug[n],a++))}return u}};","/tris/Grue/js/string/repeat":"function repeat(e,t){var r;return 1>t?\"\":t%2?repeat(e,t-1)+e:(r=repeat(e,t/2),r+r)}module.exports=repeat;","/tris/game/defaultPieceGenerator":"var random=require(\"/tris/Grue/js/number/random\"),repeat=require(\"/tris/Grue/js/string/repeat\");module.exports=function(e,t){return!e&&(e=\"OITLJSZ\"),function(r){!r&&(r=7);for(var n,o=[],s=7==r?e:repeat(e,r/7),a=s.split(\"\");a.length;){do n=t&&t.length>=r?t.pop()%a.length:random(a.length-1);while(\"R\"==a[n]&&2!=random(3));o.push(a.splice(n,1)[0])}return o}};","/tris/game/eachblock":"module.exports=function(e,t,r,n,o){for(var s=!1,a=0;5>a;a++)for(var u=0;5>u;u++)if(e[a][u]&&(s=n.call(o,t+u,r+a)),s)return};","/tris/game/Piece":"function Bag(e){EventEmitter.call(this),this.__grue_props.use_event_pool=!0,this.pieces=[],this.size=7,e&&(this.generator=e)}function Piece(e){this.x=2,this.y=0,this.r=0,this.name=e||\"\"}function RandomPiece(){Piece.call(this),this._name=\"R\",this.model=Array(4);for(var e=0;4>e;e++)this.model[e]={name:\"\",model:\"\"};this._setModel(),Object.defineProperty(this,\"name\",{get:function(){return this.model[this.r].name}})}var EventEmitter=require(\"/tris/Grue/js/infrastructure/EventEmitter\"),random=require(\"/tris/Grue/js/number/random\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),objMap=require(\"/tris/Grue/js/object/map\"),map=require(\"/tris/Grue/js/functional/map\"),oVal=[\"     \",\"     \",\" ##  \",\" ##  \",\"     \"],pieces=objMap({A:[[\"  #  \",\"  #  \",\"  ###\",\"     \",\"     \"],[\"     \",\"     \",\"  ###\",\"  #  \",\"  #  \"],[\"     \",\"     \",\"###  \",\"  #  \",\"  #  \"],[\"  #  \",\"  #  \",\"###  \",\"     \",\"     \"]],O:map(Array(4),function(){return oVal}),I:[[\"     \",\"     \",\" ####\",\"     \",\"     \"],[\"     \",\"  #  \",\"  #  \",\"  #  \",\"  #  \"],[\"     \",\"     \",\" ####\",\"     \",\"     \"],[\"  #  \",\"  #  \",\"  #  \",\"  #  \",\"     \"]],T:[[\"     \",\"  #  \",\" ### \",\"     \",\"     \"],[\"     \",\"  #  \",\"  ## \",\"  #  \",\"     \"],[\"     \",\"     \",\" ### \",\"  #  \",\"     \"],[\"     \",\"  #  \",\" ##  \",\"  #  \",\"     \"]],J:[[\"     \",\" #   \",\" ### \",\"     \",\"     \"],[\"     \",\"  ## \",\"  #  \",\"  #  \",\"     \"],[\"     \",\"     \",\" ### \",\"   # \",\"     \"],[\"     \",\"  #  \",\"  #  \",\" ##  \",\"     \"]],L:[[\"     \",\"   # \",\" ### \",\"     \",\"     \"],[\"     \",\"  #  \",\"  #  \",\"  ## \",\"    \"],[\"     \",\"     \",\" ### \",\" #   \",\"     \"],[\"     \",\" ##  \",\"  #  \",\"  #  \",\"     \"]],S:[[\"     \",\"     \",\"  ## \",\" ##  \",\"     \"],[\"     \",\"  #  \",\"  ## \",\"   # \",\"     \"],[\"     \",\"     \",\"  ## \",\" ##  \",\"     \"],[\"     \",\"  #  \",\"  ## \",\"   # \",\"     \"]],Z:[[\"     \",\"     \",\" ##  \",\"  ## \",\"     \"],[\"     \",\"   # \",\"  ## \",\"  #  \",\"     \"],[\"     \",\"     \",\" ##  \",\"  ## \",\"     \"],[\"     \",\"   # \",\"  ## \",\"  #  \",\"     \"]]},function(e){return e.map(function(e){return e.map(function(e){return e.split(\"\").map(function(e){return\"#\"==e})})})}),colors={A:\"pink\",I:\"cyan\",O:\"yellow\",T:\"purple\",S:\"green\",Z:\"red\",J:\"blue\",L:\"orange\",R:\"lightgray\"},keys=\"IOTSZJL\".split(\"\"),genFnFactory=require(\"/tris/game/defaultPieceGenerator\"),generatePieces=genFnFactory(\"OITSZJL\"),eachblock=require(\"/tris/game/eachblock\");Object.defineProperty(pieces,\"R\",{get:function(){return this[keys[random(0,6)]]}}),module.exports=function(e){return this instanceof Piece?Piece.apply(this,arguments):this instanceof RandomPiece?RandomPiece.call(this):new(\"R\"==e?RandomPiece:Piece)(e)},module.exports.Bag=Bag,module.exports.pieces=pieces,module.exports.colors=colors,inherit(Bag,EventEmitter),Bag.prototype.fill=function(){[].unshift.apply(this.pieces,this.generator(this.size))},Bag.prototype.generator=generatePieces,Bag.prototype.next=function(){this.pieces.length||this.fill();var e=this.pieces.pop();return this.emitEvent(\"next\",e),e},Bag.prototype.preview=function(e){return null==e&&(e=1),e>this.pieces.length&&this.fill(),this.pieces.slice(this.pieces.length-e)},Bag.prototype.reset=function(){return this.pieces.length=0,this},Piece.prototype.slideLeft=function(){--this.x},Piece.prototype.slideRight=function(){++this.x},Piece.prototype.rotateLeft=function(){return 0==this.r?this.r=3:--this.r,this.r},Piece.prototype.rotateRight=function(){return 3==this.r?this.r=0:++this.r,this.r},Piece.prototype.getModel=function(){return pieces[this.name][this.r]},inherit(RandomPiece,Piece),RandomPiece.prototype.getModel=function(){return!this.model[this.r].name&&this._setModel(),this.model[this.r].model},RandomPiece.prototype._setModel=function(){var e=keys[random(0,6)];this.model[this.r].name=e,this.model[this.r].model=pieces[e][this.r]};","/tris/Grue/js/dom/requestAnimationFramePolyfill":"\"undefined\"==typeof global&&\"undefined\"!=typeof window&&(global=window);for(var lastTime=0,vendors=[\"ms\",\"moz\",\"webkit\",\"o\"],x=0;vendors.length>x&&!global.requestAnimationFrame;++x)global.requestAnimationFrame=global[vendors[x]+\"RequestAnimationFrame\"],global.cancelAnimationFrame=global[vendors[x]+\"CancelAnimationFrame\"]||global[vendors[x]+\"CancelRequestAnimationFrame\"];global.requestAnimationFrame||(global.requestAnimationFrame=function(e){var t=+new Date,r=Math.max(0,16-(t-lastTime)),n=global.setTimeout(function(){e(t+r)},r);return lastTime=t+r,n}),global.cancelAnimationFrame||(global.cancelAnimationFrame=function(e){clearTimeout(e)}),exports.requestAnimationFrame=global.requestAnimationFrame,exports.cancelAnimationFrame=global.cancelAnimationFrame;","/tris/Grue/js/dom/anim/Ticker":"function _loop(e){this.requestID=requestAnimationFrame(this._loop),this.emitEvent(\"tick\",e),this.emitEvent(\"draw\",e)}function Ticker(){EventEmitter.call(this),this.__grue_props.use_event_pool=!0,this.playing=!1,this.requestID=0,this._loop=_loop.bind(this)}var EventEmitter=require(\"/tris/Grue/js/infrastructure/EventEmitter\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),af=require(\"/tris/Grue/js/dom/requestAnimationFramePolyfill\"),requestAnimationFrame=af.requestAnimationFrame,cancelAnimationFrame=af.cancelAnimationFrame;module.exports=Ticker,inherit(Ticker,EventEmitter),Ticker.prototype.toggle=function(){return this[this.playing?\"stop\":\"start\"]()},Ticker.prototype.stop=function(){return this.playing=!1,this.requestID&&cancelAnimationFrame(this.requestID),this},Ticker.prototype.start=function(){return this.playing=!0,this._loop(),this},Ticker.prototype.destroy=function(){this.stop(),this.off(),delete this.start,delete this._loop};","/tris/Grue/js/functional/each":"var stringSupportsSubscript=GRUE.has(\"str_subscriptAccess\"),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),hasObjKeys=GRUE.has(\"obj_keys\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty;module.exports=function(e,t,r){var n,o,i,s=0;if(e)if(e.length)if(n=e.length,stringSupportsSubscript||\"string\"!=typeOf(e))for(;n>s;s++)t.call(r,e[s],s,s);else for(;n>s;s++)t.call(r,e.charAt(s),s,s);else{if(supportsNullProto&&null===e.__proto__)for(n in e)t.call(r,e[n],n,s++);else if(hasObjKeys)for(n=Object.keys(e),i=n.length;i>s;s++)t.call(r,e[n[s]],n[s],s);else for(n in e)hasOwn.call(e,n)&&t.call(r,e[n],n,s++);if(dontEnumBug)for(o=0,i=dontEnumBug.length;i>o;o++)hasOwn.call(e,dontEnumBug[o])&&t.call(r,e[dontEnumBug[o]],dontEnumBug[o],s++)}};","/tris/Grue/js/string/iter":"module.exports=function(e){var t=e.length;return{string:e,length:t,index:0,prev:null,curr:e.charAt(0),next:function(r){return!r&&(r=1),t>this.index?(this.prev=this.curr,this.index+=r,this.curr=e.charAt(this.index)):null},peek:function(t){return e.charAt(this.index+(t||1))}}};","/tris/Grue/js/functional/filter":"var stringSupportsSubscript=GRUE.has(\"str_subscriptAccess\"),dontEnumBug=GRUE.has(\"obj_dontEnumBug\")&&GRUE.get(\"dontEnumBug\"),supportsNullProto=GRUE.has(\"obj_nullProto\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty;module.exports=function(e,t,r){var n,o,i,s=0,a=[];if(e){if(e.length)if(stringSupportsSubscript||\"string\"!=typeOf(e))for(n=e.length;n>s;s++)t.call(r,e[s],s,s)!==!1&&a.push(e[s]);else for(n=e.length;n>s;s++)t.call(r,e.charAt(s),s,s)!==!1&&a.push(e.charAt(s));else{if(supportsNullProto&&null===e.__proto__)for(n in e)t.call(r,e[n],n,s++)!==!1&&a.push(e[n]);else for(n in e)hasOwn.call(e,n)&&t.call(r,e[n],n,s++)!==!1&&a.push(e[n]);if(dontEnumBug)for(o=0,i=dontEnumBug.length;i>o;o++)hasOwn.call(e,dontEnumBug[o])&&t.call(r,e[dontEnumBug[o]],dontEnumBug[o],s++)!==!1&&a.push(e[dontEnumBug[o]])}return a}};","/tris/Grue/js/dom/isHostMethodOrProperty":"module.exports=function(e,t){return/^(?:function|object|unknown)$/.test(typeof e[t])};","/tris/Grue/js/object/copy":"var each=require(\"/tris/Grue/js/functional/each\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),hasOwn={}.hasOwnProperty,isHostProp=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\");module.exports=function(e,t){var r,n,o,s,i,a;if(null===e||\"object\"!=typeof e&&(e===!0||e===!1))return e;if(e instanceof Element||\"object\"==typeof e&&e.cloneNode)try{return e.cloneNode()}catch(u){console.warn(e,\" is not what it seems.\")}switch(t||typeOf(e)){case\"object\":return r=e.constructor&&e.constructor!=Object?new e.constructor:{},each(e,function(e,t){r[t]=e}),r;case\"array\":return e.slice(0);case\"date\":return new Date(+e);case\"string\":case\"number\":case\"boolean\":return Object(e.valueOf());case\"regexp\":return s=[\"\"+e],s[1]=s[0].slice(1,s[0].lastIndexOf(\"/\")).replace(/\\\\/,\"\\\\\\\\\"),s[2]=s[0].slice(s[0].lastIndexOf(\"/\")+1),RegExp(s[1],s[2]);case\"NodeList\":case\"nodelist\":for(n=document.createDocumentFragment(),i=0,a=e.length;a>i;i++)isHostProp(e[i],\"cloneNode\")&&n.appendChild(e[i].cloneNode());return n.childNodes;case\"HTMLCollection\":case\"htmlcollection\":for(o=document.createElement(\"div\"),i=0,a=e.length;a>i;i++)isHostProp(e[i],\"cloneNode\")&&o.appendChild(e[i].cloneNode());return o.children;default:return e}};","/tris/Grue/js/infrastructure/Observable":"function defineObservedProperty(e,t,r){Array.isArray(t[e])||types.isObject(t[e])?Object.defineProperty(this,e,{value:observe(t[e],function(t){notify.call(this,r,e,new GrueEvent(\"collectionChange\",{prop:e,oldValue:t.body.oldValue,value:t.body.value},!0,!1))})}):t[e]instanceof Function?this[e]=function(){var n=copy(t);t[e].apply(t,arguments),notify.call(this,r,e,new GrueEvent(\"functionCall\",{prop:e,oldValue:n,value:copy(t)},!0,!1))}:hasOwn.call(this,e)||Object.defineProperty(this,e,{get:function(){return t[e]},set:function(n){var o=t[e];t[e]=n,notify.call(this,r,e,new GrueEvent(e+\"Change\",{prop:e,oldValue:o,value:n},!0,!1))}})}function notify(e,t,r){for(var n=0,o=e[t]&&e[t].length||0;o>n;n++)e[t][n](r);if(e.__grue_all&&e.__grue_all.length)for(var n=0,o=e.__grue_all.length;o>n;n++)e.__grue_all[n](r)}function obFn(e,t){return observe(this,e,t),this}var ids=require(\"/tris/Grue/js/utils/ids\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),types=require(\"/tris/Grue/js/utils/types\"),filter=require(\"/tris/Grue/js/functional/filter\"),each=require(\"/tris/Grue/js/functional/each\"),copy=require(\"/tris/Grue/js/object/copy\"),GrueEvent=require(\"/tris/Grue/js/infrastructure/GrueEvent\"),hasOwn={}.hasOwnProperty,arrayProps=Object.getOwnPropertyNames(Array.prototype).filter(function(e){return\"constructor\"!=e}),proxyArrayProto=Object.create(null),observed=Object.create(null);each(arrayProps,function(e){\"function\"==typeof[][e]?this[e]=function(){var t=this.__grue_target.slice(0);[][e].apply(this.__grue_target,arguments),notify(this.__grue_observers,e,new GrueEvent(\"functionCall\",{prop:key,oldValue:t,value:this.__grue_target.slice(0)},!0,!1))}:Object.defineProperty(this,e,{get:function(){return this.__grue_target[e]},set:function(t){this.__grue_target[e]=t}})},proxyArrayProto),exports.observe=function(e,t,r){if(\"object\"!=typeof e)throw new TypeError(\"Observable.observe cannot be applied to type \"+typeOf(e)+\".\");if(Object.isFrozen&&Object.isFrozen(e))throw new TypeError(\"Cannot observe changes in frozen objects.\");var n,o=e.__grue_id||ids.createUID(),s=observed[o]||(observed[o]=Object.create(null)),i=s.observers||(s.observers=Object.create(null)),a=s.original||(s.original=e);if(n=s.proxy?s.proxy:Array.isArray(e)&&(s.proxy=Object.create(proxyArrayProto,{__grue_target:{value:e},observe:{value:obFn},__grue_observers:{value:i},__grue_id:{value:o}}))||(s.proxy=e.__grue_id?Object.create(e,{observe:{value:obFn}}):Object.create(e,{__grue_id:{value:o},observe:{value:obFn}})),!r&&t instanceof Function)if(r=t,t=null,i.__grue_all||(i.__grue_all=[]),i.__grue_all.push(r),Array.isArray(a))for(var u=0;arrayProps.length>u;u++)defineObservedProperty.call(n,arrayProps[u],a,i);else each(a,function(e){defineObservedProperty.call(n,e,a,i)});else defineObservedProperty.call(n,t,a,i),!i[t]&&(i[t]=[]),i[t].push(r);return n},exports.unObserve=function(e){var t=e.__grue_id,r=t&&observed[t]&&observed[t].original;return r?(each(observed[t].proxy,function(e,t){r.hasOwnProperty(t)||Object.defineProperty(r,t,{value:e}),delete this[t]},observed[t].proxy),each(observed[t].observers,function(e,r){delete observed[t].observers[r]}),setImmediate(function(){delete observed[t]}),r):(console.warn(\"trying to unObserve object that was not under observation.\"),e)};var observe=exports.observe;","/tris/Grue/js/array/indexOf":"module.exports=function(e,t,r,n){var o,s;if(3==arguments.length&&\"function\"==typeof r&&(n=r,r=0),o=r||0,s=e.length||0,n){for(;s>o;o++)if(n.call(e,e[o],t))return o}else for(;s>o;o++)if(e[o]===t)return o;return-1};","/tris/Grue/js/infrastructure/ComponentNode":"function ComponentNode(){Object.defineProperty(this,\"parents\",{value:[]}),Object.defineProperty(this,\"children\",{value:[]})}var indexOf=require(\"/tris/Grue/js/array/indexOf\"),filter=require(\"/tris/Grue/js/functional/filter\");ComponentNode.prototype={constructor:ComponentNode,get siblings(){var e=[],t=0;if(!this.parents||!this.parents.length)return e;for(;parents.length>t;t++)e.push.apply(e,filter(parents[t],function(e){return e!=this}),this);return e},indexOfChild:function(e){return e!=this&&this.children&&this.children.length?indexOf(this.children,e):-1},indexOfParent:function(e){return e!=this&&this.parents&&this.parents.length?indexOf(this.parents,e):-1},removeChild:function(e){var t=this.indexOfChild(e);return t>-1&&this.children.splice(t,1),this},removeParent:function(e){var t=this.indexOfParent(e);return t>-1&&this.parents.splice(t,1),this},addChild:function(e){if(e==this)throw Error(\"A node cannot be its own child\");return this.removeChild(e),this.children.push(e),e.removeParent(this),e.parents.push(this),this},addParent:function(e){if(e==this)throw Error(\"A node cannot be its own parent\");return this.removeParent(e),this.parents.push(e),e.removeChild(this),e.children.push(this),this},replaceChild:function(e,t){var r;if(e==t)return this;if(e==this||t==this)throw Error(\"Cannot add or remove node from itself\");return r=this.indexOfChild(e)>-1&&this.children.splice(r,1,t),this}},module.exports=ComponentNode;","/tris/Grue/js/infrastructure/utils/ownPropConfig":"var hasOwn={}.hasOwnProperty;module.exports=function OwnPropConfig(e){if(!(this instanceof OwnPropConfig))return new OwnPropConfig(e);var t;for(t in e)hasOwn.call(e,t)&&(this[t]=e[t])};","/tris/Grue/js/infrastructure/Component":"function Component(e){if(\"undefined\"!=typeof global&&this==global)throw Error(\"Component constructor invoked without `new`\");EventEmitter.call(this),ComponentNode.call(this),this.__grue_props._destroyed=!1,this.__init.call(this,e)}function extractFnParams(e){for(var t,r=iterStr(e),n=0,o=0,s=0,i=0,a=0;t=r.next();)if(\"/\"!=t||\"/\"!=r.peek()){if(\"/\"!=t||\"*\"!=r.peek()){if(o){if(\"(\"==t?++i:\")\"==t&&++a,i&&a&&i==a){s=r.index;break}}else if(\"s\"==t&&\"u\"==r.peek()&&\"p\"==r.peek(2)&&\"r\"==r.peek(3)){for(n=r.index,r.next(3);r.next()&&\" \"==r.curr;);if(\"(\"!=r.curr)continue;o=r.index+1,++i}}else for(;r.next();)if(\"\\\\\"!=r.prev&&\"*\"==r.curr&&\"/\"==r.peek()){r.next();break}}else for(;\"\\n\"!=r.next(););return r=null,{s:n,l:o,r:s,params:e.slice(o,s)}}function suprReplace(e,t,r){var n,o,s,i=extractFnParams(e),a=\"this.constructor.__ctor__ && this.constructor.__ctor__.prototype.\"+t+\" && this.constructor.__ctor__.prototype.\"+t+\".call(this, \";return 0==i.r?r:(n=[e.slice(0,i.s),a,i.params,e.slice(i.r)].join(\"\"),reSuper.test(n)&&(n=\"\"+suprReplace(n,t)),o=/\\(([^)]*)\\)/.exec(e)[1]||\"\",s=n.slice(n.indexOf(\"{\")+1,n.lastIndexOf(\"}\")),Function(o,s))}function stringVal(e,t){if(\"string\"==typeof e)e=/(['\"])/g.test(e)?e:'\"'+e+'\"';else if(\"number\"==typeof e||\"boolean\"==typeof e)e+=\"\";else if(null===e)e=\"null\";else if(void 0===e)e=\"undefined\";else if(\"function\"==typeof e)reSuper.test(\"\"+e)&&(e=\"\"+suprReplace(\"\"+e,t,e));else if(\"object\"==typeof e)try{e=JSON.stringify(e)}catch(r){console.warn(\"stringVal helper unable to create string representation for\",e,', recovering with \"{}\" instead. Exception:',r.message,r.stack),e=\"{}\"}return\"string\"==typeof e?e:\"''\"}var each=require(\"/tris/Grue/js/functional/each\"),mix=require(\"/tris/Grue/js/object/mix\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),iterStr=require(\"/tris/Grue/js/string/iter\"),Grue=require(\"/tris/Grue/js/base/Grue\"),EventEmitter=require(\"/tris/Grue/js/infrastructure/EventEmitter\"),Observable=require(\"/tris/Grue/js/infrastructure/Observable\"),ComponentNode=require(\"/tris/Grue/js/infrastructure/ComponentNode\"),OwnPropConfig=require(\"/tris/Grue/js/infrastructure/utils/ownPropConfig\"),hasOwn={}.hasOwnProperty,reSuper=/(?:^|\\s+)supr\\s*\\(/,protoMixin,protoPublish,prop;mix(ComponentNode.prototype,Component.prototype,!0),inherit(Component,EventEmitter),Component.prototype.isDestroyed=function(){return this.__grue_props._destroyed},Component.prototype.__init=function(e){return\"object\"!=typeof e?this:(e.publishes&&(this.publishes=Object.create(this.publishes),mix(e.publishes,this.publishes),delete e.publishes),each(e,function(e,t){var r,n;\"function\"==typeof e&&t in this&&(r=\"\"+e,reSuper.test(r)&&(n=extractFnParams(r),r=[r.slice(0,n.s),\"this.constructor.prototype.\"+t+\" && this.constructor.prototype.\"+t+\".call(this, \",n.params,r.slice(n.r)].join(\"\")),e=Function(/\\(([^)]*)\\)/.exec(r)[1],/\\{([^}]*)\\}/.exec(r)[1])),this[t]=e},this),void 0)},Component.prototype._init=function(){},Component.prototype._destroy=function(){},Component.prototype.publishes=Object.create(null),Component.prototype.destroy=function(e){if(this.on(\"destroyed\",function(e){return e.atTarget?void 0:(e.cancel(),e.preventDefault(),void 0)}),e!==!0){for(var t=0;this.children.length>t;t++)this.children[t].destroy&&this.children[t].destroy();this.children.length=0}!this.__grue_props._destroyed&&this.emitEvent(\"destroyed\"),this.__grue_props._destroyed=!0,this.off(),this.parents.length=0,this._destroy&&this._destroy()},Component.prototype.supr=function(){var e=this.constructor.prototype&&this.constructor.prototype[arguments[0]],t=[].slice.call(arguments,1);return e&&e.apply(this,t)},Component.prototype._propagateEvent=function(e){for(var t=0,r=this.parents,n=r.length;n>t&&(r[t]&&\"object\"==typeof r[t]&&r[t].emitEvent&&r[t].emitEvent(e),!e.canceled);t++);return this},module.exports=Component,protoMixin=Object.create(null),mix(Grue.prototype,protoMixin),mix(EventEmitter.prototype,protoMixin),mix(Component.prototype,protoMixin),Component.extend=function(superType,setup){var ctorBody=\"\",ctorProps=\"\",ownProps=\"\",ctorMixins,hasObservedCollection=!1,unObserveOnDestroy=[],ComponentType,argsFromConfig,ctorArgs,supProto,testInst,needsComponentMixin,prop;if(superType&&\"function\"!=typeof superType&&!setup&&(setup=superType,superType=null),!setup&&(setup={}),setup.ownProps&&each(setup.ownProps,function(e,t){var r;if(\"string\"==typeof e&&\"@proto\"==e&&setup.proto&&setup.proto[t])r=(setup.name?setup.name+\".prototype.\":\"this.constructor.prototype.\")+t;else{if(e instanceof OwnPropConfig)return\"boolean\"!=typeof e.writeable&&(e.writeable=!0),r=stringVal(e,t),ownProps+='    Object.defineProperty(this, \"'+t+'\", typeof config.'+t+' != \"undefined\" && config.'+t+\" || \"+r+\");\\n\",void 0;r=stringVal(e,t)}ownProps+=\"    this.\"+t+\" = typeof config.\"+t+' != \"undefined\" && config.'+t+\" || \"+r+\";\\n\"}),setup.name&&(ctorBody+=\"ComponentType = function \"+(setup.name||\"\")+\"(config) {\\n\"),ctorBody+=\"    !config && (config = {});\\n\",ctorBody+=ownProps,setup.observable&&(!setup.proto&&(setup.proto={}),!setup.proto.publishes&&(setup.proto.publishes={change:!0}),each(setup.observable,function(e,t){var r=stringVal(e,t),n=t+\"Change\";setup.proto.publishes[n]=!0,r&&(ctorProps+=\"    this.\"+(e&&\"object\"==typeof e?t:'__grue_props[\"'+t+'\"]')+\" = \"+r+\";\\n\"),e&&\"object\"==typeof e&&(ctorBody+=\"    this.\"+t+' = Observable.observe(this, \"'+t+'\", this.__collectionChangeHandler.bind(this));\\n',hasObservedCollection=!0,unObserveOnDestroy.push(t),delete setup.observable[t])})),superType){if(ctorBody+=\"    this.constructor.__ctor__ && this.constructor.__ctor__.\",setup.argsFromConfig){argsFromConfig=setup.argsFromConfig===!0?function(){var e=\"\"+superType,t=e.indexOf(\"(\")+1,r=e.indexOf(\")\",t);return e.slice(t,r).replace(/\\s+/g,\"\").split(\",\")}():setup.argsFromConfig,ctorArgs=[];for(var i=0,l=argsFromConfig.length;l>i;i++)ctorArgs.push(\"config.\"+argsFromConfig[i]);ctorBody+=\"call(this, \"+ctorArgs.join(\", \")+\");\\n\";for(var i=0;l>i;i++)ctorBody+=\"    delete config.\"+argsFromConfig[i]+\";\\n\"}else ctorBody+=\"apply(this, arguments);\\n\";try{testInst=new superType}catch(e){testInst={},console.warn(\"New component constructor may be invalid.\",e)}testInst instanceof Component||testInst.__init&&testInst._init&&testInst.supr&&testInst._propagateEvent&&testInst.destroy&&testInst.parents&&testInst.children&&testInst.indexOfChild&&testInst.indexOfParent&&testInst.removeChild&&testInst.removeParent&&testInst.addChild&&testInst.addParent&&testInst.replaceChild&&testInst.on&&testInst.off&&testInst.once&&testInst.emitEvent&&testInst.spawn&&testInst.tap&&testInst.__grue_id&&testInst.__grue_props||(ctorBody+=\"    Component.call(this, config);\\n\",needsComponentMixin=!0)}else ctorBody+=\"    Component.call(this, config);\\n\";if(ctorBody+=ctorProps,setup.proto&&setup.proto._init&&setup.autoInit!==!1&&(ctorBody+=setup.name?\"    \"+setup.name+\".prototype._init.apply(this, [].slice.call(arguments, 1));\\n\":\"    this._init.apply(this, [].slice.call(arguments, 1));\\n\"),hasObservedCollection&&(setup.proto.__collectionChangeHandler=function(e){this.emitEvent(e.prop,e.body),this.emitEvent(e.prop+\"Change\",e.body)},setup.proto.__unobserve=Function(\"\",\"    var list = [\"+unObserveOnDestroy+\"], i = 0, l = list.length;\\n\"+\"    for (; i < l; i++)\\n\"+\"        Observable.unObserve(this[list[i]]);\\n\"),ctorBody+='    this.on(\"destroyed\", this.__unobserve);\\n'),setup.ctorMixins&&setup.ctorMixins.length&&(ctorMixins=setup.ctorMixins.slice(0),ctorBody+=\"    this.__grue_init.call(this, config);\\n\"),setup.name?(ctorBody+=\"}\",ctorBody+=\"\\n//@ sourceURL=/ComponentCtors/\"+setup.name+\".js\",eval(ctorBody)):ComponentType=Function(\"config\",ctorBody),inherit(ComponentType,superType||Component),needsComponentMixin&&mix(protoMixin,ComponentType.prototype,!0,!1),setup.observable&&each(setup.observable,function(e,t){var r,n,o=t+\"Change\";setup.proto.publishes[o]=!0,e&&\"object\"==typeof e||(r='    var oldVal = this.__grue_props[\"'+t+'\"],\\n'+\"        evBody = {\\n\"+'            propName: \"'+t+'\",\\n'+\"            oldValue: oldVal,\\n\"+\"            value: val\\n\"+\"        };\\n\"+'    this.__grue_props[\"'+t+'\"] = val;\\n'+'    this.emitEvent(\"'+o+'\", evBody);\\n'+'    this.emitEvent(\"change\", evBody);\\n',n='    return this.__grue_props[\"'+t+'\"];\\n',Object.defineProperty(this,t,{set:Function(\"val\",r),get:Function(\"\",n)}))},ComponentType.prototype),setup.proto&&(protoPublish=setup.proto.publishes,delete setup.proto.publishes,each(setup.proto,function(e,t){if(\"function\"==typeof e){var r=\"\"+e;reSuper.test(r)&&(setup.proto[t]=suprReplace(r,t,e))}})),mix(setup.proto,ComponentType.prototype,!1,!0),ComponentType.prototype.publishes=Object.create(superType&&superType.prototype.publishes||Component.prototype.publishes),mix(protoPublish,ComponentType.prototype.publishes,!0),ctorMixins&&ctorMixins.length){Object.defineProperty(ComponentType.prototype,\"__grue_init\",{value:function(e){if(!this.__grue_props.init_done){for(var t=0,r=ctorMixins.length;r>t;t++)ctorMixins[t].call(this,e);this.__grue_props.init_done=!0}}});for(var i=0,l=ctorMixins.length;l>i;i++)mix(ctorMixins[i].prototype,ComponentType.prototype,!0,!0)}return ComponentType.prototype.constructor=ComponentType,ComponentType};","/tris/Grue/js/dom/events/isEventSupported":"function isEventSupported(e,t,r){\"boolean\"==typeof t&&(r=t,t=null),r===void 0&&(r=!1);var n,o,s,i=e&&!t;return i&&cache[+r][e]?!!cache[+r][e]:(n=t?t==window?t:t.cloneNode(!1):windowEvents[e]?window:document.createElement(TAGNAMES[e]||\"div\"),r&&!n.addEventListener?!1:(o=\"on\"+e,s=o in n,!s&&n.setAttribute&&n.removeAttribute&&(n.setAttribute(o,\"return;\"),s=\"function\"==typeof n[o],n[o]!==void 0&&(n[o]=void 0),n.removeAttribute(o)),!s&&useHasFeature&&\"wheel\"==e&&(s=document.implementation.hasFeature(\"Events.wheel\",\"3.0\")),n=null,i?cache[+r][e]=s:s))}module.exports=isEventSupported;var useHasFeature=document.implementation&&document.implementation.hasFeature&&document.implementation.hasFeature(\"\",\"\")!==!0,TAGNAMES={select:\"input\",change:\"input\",submit:\"form\",reset:\"form\",error:\"img\",load:\"img\",abort:\"img\"},windowEvents={resize:!0,transitionend:!0,animationend:!0,animationstart:!0,scroll:!0,unload:!0,orientationchange:!0},cache=[{focusin:\"onfocusin\"in window,focusout:\"onfocusout\"in window},{}];","/tris/Grue/js/dom/contains":"var docEl=document&&document.documentElement;if(!docEl)throw Error(\"Grue/dom/contains requires an HTML DOM\");module.exports=\"compareDocumentPosition\"in docEl?function(e,t){return 16==(16&e.compareDocumentPosition(t))}:\"contains\"in docEl?function(e,t){return e!==t&&e.contains(t)}:function(e,t){for(;t=t.parentNode;)if(t===e)return!0;return!1};","/tris/Grue/js/dom/events/bind":"function copy(e){var t,r={};for(t in e)r[t]=e[t];return r.type=\"mouseover\"==e.type?\"mouseenter\":\"mouseleave\",r}function getHandler(e,t,r,n){var o;return o=\"mouseenter\"==t&&!has_enter||\"mouseleave\"==t&&!has_leave?function(e){var t,o=this,s=e.relatedTarget;if(!s||s!=o&&!contains(o,s)){try{t=copy(e)}catch(i){t=e}r.call(n,t)}}:function(e){r.call(n,e)}}var isHostMethodOrProperty=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\"),isEventSupported=require(\"/tris/Grue/js/dom/events/isEventSupported\"),contains=require(\"/tris/Grue/js/dom/contains\"),docEl=document&&document.documentElement,useCapture={},eventMap={},hasOwn={}.hasOwnProperty,has_focusIn,has_focusOut,has_enter,has_leave,stopPropagation,addEvent;if(!docEl)throw Error(\"DOM utilities require a DOM\");has_focusIn=isEventSupported(\"focusin\"),has_focusOut=isEventSupported(\"focusout\"),has_enter=isEventSupported(\"mouseenter\"),has_leave=isEventSupported(\"mouseleave\"),!has_focusIn&&(useCapture.focusin=!0)&&(eventMap.focusin=\"focus\"),!has_focusOut&&(useCapture.focusout=!0)&&(eventMap.focusout=\"blur\"),!has_enter&&(eventMap.mouseenter=\"mouseover\"),!has_leave&&(eventMap.mouseleave=\"mouseleave\"),isHostMethodOrProperty(docEl,\"addEventListener\")?addEvent=function(e,t,r,n){if(n===void 0&&(n=e),~t.indexOf(\" \"))return function(){for(var o,s=[e,\"\",r,n],i=t.split(\" \"),u=[],a=0;i.length>a;a++)o=s.slice(0),o[1]=i[a],u.push(addEvent.apply(void 0,o));return u}();var o=getHandler(e,t,r,n);return e.addEventListener(eventMap[t]||t,o,!!useCapture[t]),o.el=e,[eventMap[t]||t,o,!!useCapture[t]]}:isHostMethodOrProperty(docEl,\"attachEvent\")&&(\"undefined\"==typeof GRUE&&(GRUE={}),!GRUE._boundEls&&(GRUE._boundEls=[]),addEvent=function(e,t,r,n){function o(){var e,t=window.event;try{e=copy(t)}catch(o){throw console.error(o.message),o}e.defaultPrevented===void 0&&(e.defaultPrevented=!!t.returnValue),e.target===void 0&&(e.target=t.srcElement),e.stopPropagation=function(){t.cancelBubble=!0},e.preventDefault=function(){t.returnValue=!1},n===void 0&&(n=GRUE._boundEls[s]),r.call(n,e),n=null}if(useCapture[t])throw Error(\"Browser does not support capture phase\");if(~t.indexOf(\" \"))return function(){for(var o,s=[e,\"\",r,n],i=t.split(\" \"),u=[],a=0;i.length>a;a++)o=s.slice(0),o[1]=i[a],u.push(addEvent.apply(void 0,o));return u}();var s=GRUE._boundEls.length;return GRUE._boundEls.push(e),e.attachEvent(\"on\"+t,o),e=null,[\"on\"+t,o,s]}),module.exports=addEvent;","/tris/Grue/js/dom/events/unbind":"var isHostMethod=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\"),docEl=document&&document.documentElement;if(!docEl)throw Error(\"DOM utilities require a DOM\");if(isHostMethod(docEl,\"removeEventListener\"))module.exports=function(e){return e[1]&&e[1].el?(e[1].el.removeEventListener(e[0],e[1],e[2]),e.length=0,void 0):console.error(\"invalid handle passed to Grue/dom/events/unbind\")};else if(isHostMethod(docEl,\"detachEvent\")){if(\"undefined\"==typeof GRUE||GRUE._boundEls===void 0)throw Error(\"This will not work\");module.exports=function(e){GRUE._boundEls[e[2]].detachEvent(e[0],e[1]),GRUE._boundEls[e[2]]=void 0,e.length=0}}","/tris/Grue/js/base/has/qsa":"module.exports=document&&/^(?:function|object|unknown)$/.test(typeof document.querySelectorAll);","/tris/Grue/js/string/hyphenToCamel":"module.exports=function(e){return e.replace(/-(.?)/g,function(e,t){return t.toUpperCase()})};","/tris/Grue/js/dom/matches":"for(var vendors=[\"\",\"webkit-\",\"moz-\",\"ms-\",\"o-\"],div=document.createElement(\"div\"),isHostMethod=require(\"/tris/Grue/js/dom/isHostMethodOrProperty\"),hasQSA=require(\"/tris/Grue/js/base/has/qsa\"),hyphenToCamel=require(\"/tris/Grue/js/string/hyphenToCamel\"),matches,i=0;5>i;i++)if(isHostMethod(div,hyphenToCamel(vendors[i]+\"matchesSelector\"))){matches=hyphenToCamel(vendors[i]+\"matchesSelector\");break}module.exports=matches?function(e,t){return e[matches](t)}:hasQSA?function(e,t){for(var r=document&&document.querySelectorAll(t),n=0,o=r.length;o>n;n++)if(r[n]==e)return!0;return!1}:function(){throw Error(\"matches or matchesSelector not implemented\")};","/tris/Grue/js/dom/events/DOMEvents":"function keyEventDelegateFn(){}function delegateFn(e,t){var r=e.selectors.targets,n=e.selectors.selectors;return function(o){!o&&window.event&&(o=window.event);var s,i,a=getTarget(o),u=(o.type,[]);s=a.id||a.getAttribute(\"data-gid\"),null==s||s!=a.id||e.targets[s]||(s=a.getAttribute(\"data-gid\")),null!=s&&e.targets[s]&&fire(e.targets[s],o),t===!1&&each(e.targets,function(e,t){var r;e.length&&(r=document.getElementById(t),r||(r=document.querySelector('[data-gid=\"'+t+'\"]')),r&&contains(r,a)&&fire(e,o))});for(var l=0,c=n.length;c>l;l++)if(r[n[l]]&&r[n[l]].length&&matchesSelector(a,n[l])&&[].push.apply(u,r[n[l]]),t===!1&&!matchesSelector(a,n[l])){i=document.querySelectorAll(n[l]);for(var p=0,d=i.length;d>p;p++)r[n[l]].length&&contains(i[p],a)&&[].push.apply(u,r[n[l]])}u.length&&fire(u,o)}}function getTarget(e){if(!e&&(e=\"undefined\"!=typeof window&&window.event),!e)throw Error(\"No event object\");return e.target?1==e.target.nodeType&&e.target||e.target.parentNode:e.srcElement?1==e.srcElement&&e.srcElement:e.srcElement.parentNode}function fire(e,t){for(var r=0,n=e.length;n>r;r++)e[r]&&e[r](t)}var bind=require(\"/tris/Grue/js/dom/events/bind\"),unbind=require(\"/tris/Grue/js/dom/events/unbind\"),matchesSelector=require(\"/tris/Grue/js/dom/matches\"),contains=require(\"/tris/Grue/js/dom/contains\"),ids=require(\"/tris/Grue/js/utils/ids\"),each=require(\"/tris/Grue/js/functional/each\"),windowEvents={load:!0,scroll:!0,resize:!0,orientationchange:!0},registry={};if(!document||!document.documentElement)throw Error(\"Grue/dom/events/on requires a document with a document element. use xhtml or html5 and correct markup\");\"undefined\"==typeof global&&\"undefined\"!=typeof window&&(global=window),exports.on=function(e,t,r,n,o,s){var i,a,u,l,c,p,d;if(\"function\"==typeof r&&(null!=n&&(\"boolean\"==typeof n?(\"object\"==typeof o&&(s=o),o=n):\"object\"==typeof n&&(s=n,o=!0)),n=r,r=t,\"string\"==typeof e?(t=e,e=null):t=null),o&&\"object\"==typeof o&&!s&&(s=o),o!==!1&&(o=!0),\"function\"!=typeof n)throw TypeError(\"Bad arguments passed to DOMEvents.on\");if(e&&null===t)return bind(e,r,n,s);if(null==e&&\"string\"==typeof t&&\"#\"==t.charAt(0)&&/^[^,>+~]+$/.test(selector)&&/^#[a-z-]+(\\s|$)/i.test(selector)&&(p=/\\s/.exec(t),d=p&&p.index&&t.slice(1,p.index),d&&(e=document.getElementById(d),e?t=t.slice(p.index+1):e=null)),null==e&&(e=windowEvents[r]?global:document),\"string\"==typeof t||e!=global&&e!=document||(o=!0),i=e==global?\"window\":e==document?\"document\":e.id||e.getAttribute(\"data-gid\")||e.nodeName&&e.nodeName.toLowerCase(),registry[i]||(registry[i]={}),registry[i][r]||(registry[i][r]={}),o?(registry[i][r].targeted||(registry[i][r].targeted={}),u=registry[i][r].targeted):(registry[i][r].normal||(registry[i][r].normal={}),u=registry[i][r].normal),u.targets||(u.targets={},u.selectors={targets:{},selectors:[]},u.removeAll=bind(e,r,delegateFn(u,o),module)),l=null===s?n:null==s&&\"string\"!=typeof t?function(e){n.call(t,e)}:function(e){n.call(s,e)},t){if(\"string\"==typeof t)return a=u.selectors.targets,null==a[t]&&(a[t]=[])&&u.selectors.selectors.push(t),a[t].push(l),[t,i,r,l,o];if(1!=t.nodeType)throw Error(\"DOMEvents.on cannot delegate event handling for \"+t);a=u.targets,c=t.id,!c&&(c=t.getAttribute(\"data-gid\")),c||(c=ids.createUID(),t.setAttribute(\"data-gid\",c),t=null),a[c]||(a[c]=[]),a[c].push(l)}return[c,i,r,l,o]},exports.off=function(e,t){var r,n,o,s,i=\"string\"!=typeof e&&e.length&&e;if(i){if(5>i.length)return unbind(i);if(5==i.length){if(r=i[4]?\"targeted\":\"normal\",n=registry[i[1]][i[2]][r].targets[i[0]])for(var a=0,u=n.length;u>a;a++)if(n[a]==i[3])return n.splice(a,1),i.length=0,void 0;if(n=registry[i[1]][i[2]][r].selectors.targets[i[0]])for(var a=0,u=n.length;u>a;a++)if(n[a]==i[3])return n.splice(a,1),i.length=0,void 0}return console.error(\"unable to unbind\",e,t)}if(\"string\"!=typeof e&&1==e.nodeType?o=e.id||e.getAttribute(\"data-gid\"):s=e,!t)throw Error(\"Cannot unbind \"+arguments);each(registry,function(e){e[t]&&(o?(e[t].normal.targets[o]&&e[t].normal.targets[o].length&&(e[t].normal.targets[o].length=0),e[t].targeted.targets[o]&&e[t].targeted.targets[o].length&&(e[t].targeted.targets[o].length=0)):(e[t].normal.selectors.targets[s]&&e[t].normal.selectors.targets[s].length&&(e[t].normal.selectors.targets[s].length=0),e[t].targeted.selectors.targets[s]&&e[t].targeted.selectors.targets[s].length&&(e[t].targeted.selectors.targets[s].length=0)))})},exports.destroy=function(){each(registry,function(e,t){each(e,function(t,r){t.removeAll&&unbind(t.removeAll),delete e[r]}),delete registry[t]})};","/tris/game/Game":"function Actions(){this._ptr=0,Object.defineProperty(this,\"_ptr\",{enumerable:!1}),this.items=Array(20)}function GameState(){this.initial=!0,this.pieceIsNew=!1,this.ended=!1,this.playing=!1,this.sliding=!1,this.descending=!1,this.rendering=!1,this.suspended=!1}function GameCounters(){this.motionless=0,this.slideFrames=0,this.softDropped=0,this.hardDropped=0,this.frameCt=0}function Game(){Component.apply(this,arguments),this.layout=null,this._toggleBtn=null,this.bag=null,this.board=null,this.props=null,this.ticker=null,this.scoreCtor=null,this.boardCtor=null,this._keyState={down:!1,action:-1,ct:0},this.keyMap=Object.create(null),this._actions=new Actions,this._options=null,this.score=null,this.preview=null,this.dx=0,this.dy=0,this.piece=null,Object.defineProperties(this,{_toggleBtn:{value:null,writeable:!0},_state:{value:new GameState,writeable:!0},_counters:{value:new GameCounters,writeable:!0},_piecesSeen:{value:Object.create(null),writeable:!0},_piece:{value:new Piece(null,this.dx,this.dy),writeable:!0}})}var inherit=require(\"/tris/Grue/js/OO/inherit\"),Component=require(\"/tris/Grue/js/infrastructure/Component\"),DOMEvents=require(\"/tris/Grue/js/dom/events/DOMEvents\"),mix=require(\"/tris/Grue/js/object/mix\"),each=require(\"/tris/Grue/js/functional/each\"),Piece=require(\"/tris/game/Piece\"),ACTIONS={left:1,right:2,rotate_left:3,rotate_right:4,soft_drop:5,hard_drop:6,clear:7};module.exports=Game,Game.ACTIONS=ACTIONS,Actions.prototype.push=function(){for(var e=0;arguments.length>e;e++)this.items[this.ptr++]=arguments[e]},Object.defineProperty(Actions.prototype,\"ptr\",{set:function(e){e>19&&(e=0),this._ptr=e},get:function(){return this._ptr},enumerable:!0}),Object.defineProperty(Actions.prototype,\"length\",{set:function(e){e>19&&(e=0),this._ptr=e},get:function(){return this._ptr},enumerable:!0}),Object.defineProperty(Game,\"ACTIONS\",{enumerable:!1}),mix({publishes:Object.create(Component.prototype.publishes,{levelup:{value:!0},scoreChange:{value:!0},playing:{value:!0}}),reset:function(){var e=this.props;this.ticker.stop(),this.dx=e.cellsize_x||e.cellsize,this.dy=e.cellsize_y||e.cellsize,each(Piece.pieces,function(e,t){this._piecesSeen[t]=0},this),this._actions.length=0,each(this.props.controls,function(e,t){80!=e&&\"up_turns_right\"!=t&&\"hard_drop\"!=t&&(this.keyMap[e]=ACTIONS[t])},this),this.keyMap[38]=this.props.controls.up_turns_right?ACTIONS.rotate_right:ACTIONS.rotate_left,GameState.apply(this._state),GameCounters.apply(this._counters),this._renderHighScore(),this._newScoreBoard(),this._newPlayField(),this.preview.clear(),this.bag.reset().fill()},init:function(){this.reset(),this.layout.playfield.appendChild(this.board.canvas),this._toggleBtn=this.layout.root.querySelector('.meta > button[name=\"toggle\"]'),this._bindEvents(),this._bindDomEvents()},nextPiece:function(){var e=this.bag.next();this.piece=new Piece(e,this.dx,this.dy),Piece.call(this._piece,e,this.dx,this.dy),++this._piecesSeen[e],GameCounters.call(this._counters),this._state.pieceIsNew=!0,this._state.descending=!0,this._state.sliding=!0,this.board.refresh(),this.board.willIntersect(this.piece)&&this.gameOver()},update:function(){if(this._state.playing&&!this._state.suspended&&!this._state.ended){this._keyState.down&&(this._keyState.ct?--this._keyState.ct:(this._keyState.ct=6,this._actions.push(this._keyState.action)));var e,t,r=this.score.level,n=this.props.max_speed;if(e=9>r?48-5*r:9==r?6:13>r?5:16>r?4:18>r?3:29>r?2:1,n>e&&(e=n),++this._counters.frameCt==e&&(this._counters.frameCt=0),this._state.rendering=!!this._actions.length||!this._counters.frameCt,t=this._actions.length){for(var o=0;t>o;o++)switch(this._actions.items[o]){case ACTIONS.left:this.maybeSlideLeft();break;case ACTIONS.right:this.maybeSlideRight();break;case ACTIONS.rotate_left:this.maybeRotateRight();break;case ACTIONS.rotate_right:this.maybeRotateLeft();break;case ACTIONS.soft_drop:this.maybeSlideDown(!0);break;case ACTIONS.hard_drop:this.hardDrop();break;case ACTIONS.clear:return this._actions.length=0,this.clearRows()}this._actions.length=0}if(this._state.descending)this._counters.frameCt||this.maybeSlideDown();else if(this._state.sliding)if(this.piece.type==this._piece.type&&this.piece.x==this._piece.x&&this.piece.y==this._piece.y&&this.piece.r==this._piece.r?++this._counters.motionless:this._counters.motionless=0,this._piece.x=this.piece.x,this._piece.y=this.piece.y,this._piece.r=this.piece.r,!this._counters.slideFrames||this._counters.motionless>29){if(this.piece.y){if(++this.piece.y,!this.board.willIntersect(this.piece))return this._state.descending=!1,this.maybeSlideDown();--this.piece.y,this.board.occupy(this.piece),this._actions.push(ACTIONS.clear)}else this.gameOver();this._state.sliding=!1}else--this._counters.slideFrames}},gameOver:function(){this._state.playing&&this.togglePlay(),this._state.ended=!0,this._updateHighScores(),alert(\"Game Over!\"),this.newGame()},maybeSlideLeft:function(){this._maybeSlide(!0)},maybeSlideRight:function(){this._maybeSlide(!1)},maybeSlideDown:function(e){this._state.descending&&(this._counters.traveled=0,this.maybeToggleDescent()&&(++this.piece.y,e&&++this._counters.softDropped))},hardDrop:function(){for(var e=0;++e,this._state.descending;)this.maybeSlideDown();--e,this._counters.hardDropped=e,this._counters.slideFrames=0},maybeRotateLeft:function(){this._maybeRotate(!0)},maybeRotateRight:function(){this._maybeRotate(!1)},_maybeSlide:function(e){e?--this.piece.x:++this.piece.x;var t=this.board.willIntersect(this.piece);t&&(e?++this.piece.x:--this.piece.x),this._state.descending||this.maybeToggleDescent()},_maybeRotate:function(e){e?this.piece.rotateLeft():this.piece.rotateRight();var t=this.board.willIntersect(this.piece);if(t){if(++this.piece.x,t=this.board.willIntersect(this.piece),!t)return;if(this.piece.x-=2,t=this.board.willIntersect(this.piece),!t)return;++this.piece.x,e?this.piece.rotateRight():this.piece.rotateLeft()}else this._state.descending||this.maybeToggleDescent()},clearRows:function(){var e=this.board.maybeClearRows(this.piece);e?this.score.set(e,this._counters.softDropped,this._counters.hardDropped,\"R\"==this.piece._name?this.level+random(1,100):0):this.nextPiece()},maybeToggleDescent:function(){++this.piece.y;var e=this.board.willIntersect(this.piece);return--this.piece.y,e?this._state.descending&&(this._state.descending=!1,this._counters.slideFrames=11>this.level?45-2*this.score.level:25>this.level?25-(this.level-10):40>this.level?15:10):this._state.descending=!0,this._state.descending},render:function(){this._state.playing&&this._state.rendering&&!this._state.ended&&(this.board.drawPiece(this.piece,this._state.pieceIsNew),this._state.pieceIsNew&&(this._state.pieceIsNew=!1))},on:function(){!this.__grue_props.dom_handles&&(this.__grue_props.dom_handles=[]);try{Component.prototype.on.apply(this,arguments)}catch(e){this.__grue_props.dom_handles.push(DOMEvents.on.apply(null,arguments))}return this},togglePlay:function(){return this._state.playing||this.ticker.playing||this.ticker.toggle(),this._state.playing=!this._state.playing,this._state.initial&&(this.nextPiece(),this._state.initial=!1),this._state.playing&&this.board.canvas.focus(),this.emitEvent(\"playing\",this._state.playing),this},newGame:function(){return this._state.ended?this.reset():(this._state.playing&&this.togglePlay(),confirm(\"Really Start Over?\")?this.reset():this.togglePlay(),void 0)},_newScoreBoard:function(){this.score&&this.score.destroy(),this.score=new this.scoreCtor,this.score.scoring=this.props.scoring,this.score.totalNode=this.layout.scoreboard.lastElementChild.lastChild,this.score.levelNode=this.layout.scoreboard.firstElementChild.lastChild,this.score.rowsNode=this.layout.scoreboard.firstElementChild.nextElementSibling.lastChild,this.score.ticker=this.ticker,this.score.init(),this.score.level=this.props.start_level},_renderHighScore:function(e){this.layout.highscores||(this.layout.highscores=this.layout.root.getElementsByClassName(\"highscores\")[0]);for(var t,r,n=this.layout.highscores;n.children.length>1;)n.removeChild(n.lastChild);if(!e){if(e=localStorage.getItem(\"scores\"),!e)return;e=JSON.parse(e)}t=document.createElement(\"ol\"),t.className=\"score-list\",r=\"\";for(var o=0;e.length>o;o++)r+=\"<li><span>total <b>\"+e[o].total+\"</b></span> <span>level <b>\"+e[o].level+\"</b></span></li>\";t.innerHTML=r,n.appendChild(t)},_updateHighScores:function(){var e,t,r=this.score.level,n=this.score.total,o=localStorage.getItem(\"scores\");if(o=o?JSON.parse(o):[],e=o.length,t=o.length,e){for(;e--&&!(o[e].total>=n););if(~e&&o[e].total==n){if(o[e].level==r)return;for(var s=0;o.length>s;s++)if(o[s].total==n&&o[s].level==r)return}for((-1==e||o[e].total>n||r>o[e].level)&&++e,10>t&&++t;--t>e;)o[t]=o[t-1]}10>e&&(o[e]={total:n,level:r}),localStorage.setItem(\"scores\",JSON.stringify(o)),this._renderHighScore(o)},_newPlayField:function(){return this.board?this.board.reset(this.props.rows,this.props.cols,this.dx,this.dy):(this.board=new this.boardCtor(this.ticker,this.props.rows,this.props.cols,this.dx,this.dy),void 0)},_bindEvents:function(){this.__grue_props.grue_handles=[],this.__grue_props.grue_handles.push(this.ticker.on(\"tick\",this.update,this).lastRegisteredHandler),this.__grue_props.grue_handles.push(this.ticker.on(\"draw\",this.render,this).lastRegisteredHandler),this.__grue_props.grue_handles.push(this.board.on(\"outOfBounds\",this.gameOver,this).lastRegisteredHandler),this.__grue_props.grue_handles.push(this.board.on(\"animating\",function(e){this._state.suspended=e.body,!e.body&&this.nextPiece()},this)),this.__grue_props.grue_handles.push(this.on(\"playing\",function(e){this._toggleBtn.innerHTML=e.body?\"Pause\":\"Play\"},this).lastRegisteredHandler)},_bindDomEvents:function(){this.__grue_props.dom_handles,this.on(this.layout.root,\"keydown\",function(e){if(!this._state.ended){var t=this.props.controls,r=this.props.slide_fast;e.target!=this.board.canvas||this._state.initial||(e.preventDefault(),this.keyMap[e.which]?!r||this._keyState.down||this.keyMap[e.which]==ACTIONS.rotate_left||this.keyMap[e.which]==ACTIONS.rotate_right?this._actions.push(this.keyMap[e.which]):(this._keyState.down=!0,this._keyState.action=this.keyMap[e.which]):e.which==t.hard_drop?this._actions.push(ACTIONS.hard_drop):e.which==t.play_toggle&&this.togglePlay())}},!1,this),this.on(this.layout.root,\"keyup\",function(){this._keyState.down=!1,this._keyState.action=0,this._keyState.ct=0},!1,this)},_unbindDomEvents:function(){var e=this.__grue_props.dom_handles;if(e){for(var t=0;e.length>t;t++)DOMEvents.off(e[t]);this.__grue_props.dom_handles.length=0,delete this.__grue_props.dom_handles}},_destroy:function(){this._unbindDomEvents(),delete this.__grue_props.dom_handles;for(var e=this.__grue_props.grue_handles,t=0;e.length>t;t++)e[t].off();this.board.destroy(),this.preview.destroy(),this.score.destroy(),this.bag.destroy(),this.ticker.destroy()}},Game.prototype),inherit(Game,Component);","/tris/game/PieceRenderer":"function PieceRenderer(){arguments.length&&this.refresh.apply(this,arguments)}function drawBlock(e,t,r,n,o,s){s.fillStyle=e,s.fillRect(t*n,r*o,n,o);var i=.1*n,a=.1*o;s.beginPath(),s.moveTo(t*n,r*o),s.lineTo(t*n+i,r*o+a),s.lineTo(t*n+i,r*o+9*a),s.lineTo(t*n+9*i,r*o+9*a),s.lineTo(t*n+n,r*o+o),s.lineTo(t*n,r*o+o),s.lineTo(t*n,r*o),s.closePath(),s.fillStyle=\"rgba(0, 0, 0, 0.2)\",s.fill(),s.beginPath(),s.moveTo(t*n,r*o),s.lineTo(t*n+n,r*o),s.lineTo(t*n+n,r*o+o),s.lineTo(t*n+9*i,r*o+9*a),s.lineTo(t*n+9*i,r*o+a),s.lineTo(t*n+i,r*o+a),s.lineTo(t*n,r*o),s.closePath(),s.fillStyle=\"rgba(255, 255, 255, 0.5)\",s.fill()}var mix=require(\"/tris/Grue/js/object/mix\"),eachblock=require(\"/tris/game/eachblock\");module.exports=PieceRenderer,mix({refresh:function(e,t,r,n){this._models=e,this._colors=t,this._sprites=document.createElement(\"canvas\"),this._spritePos=Object.create(null),this._dx=r,this._dy=n,this._tileH=5*r,this._tileW=5*n;var o,s=Object.keys(e);return Math.floor,this._sprites.width=5*this._tileW,this._sprites.height=s.length*this._tileH,o=this._sprites.getContext(\"2d\"),s.forEach(function(s,i){this._spritePos[s]=i,e[s].forEach(function(e,a){eachblock(e,5*a,5*i,function(e,i){drawBlock(t[s],e,i,r,n,o)})})},this),this},draw:function(e,t,r){if(null==r&&(r=t,t=0),null==this._spritePos[e.name])throw Error('Was expecting one of \"'+Object.keys(this._models).join('\", \"')+'\" but saw '+e.name+\" instead\");r.drawImage(this._sprites,e.r*this._tileW,this._spritePos[e.name]*this._tileH,this._tileW,this._tileH,e.x*this._dx,(e.y+t)*this._dy,this._tileW,this._tileH)},clear:function(e,t){var r=this._dx,n=this._dy;eachblock(this._models[e.name][e.r],e.x,e.y,function(e,o){t.clearRect(e*r,o*n,r,n)})}},PieceRenderer.prototype),PieceRenderer.drawBlock=drawBlock,PieceRenderer.drawPiece=function(e,t,r,n,o,s,i,a){eachblock(e,r,n,function(e,r){drawBlock(t,e,r,o,s,a)})},PieceRenderer.eachblock=eachblock;","/tris/game/Preview":"function Preview(){this.canvas=document.createElement(\"canvas\"),this.ctx=this.canvas.getContext(\"2d\"),this._showNextCt=1,this._h=0,this._w=0,this._bag=null,Object.defineProperties(this,{_showNextCt:{enumerable:!1},_h:{enumerable:!1},_w:{enumerable:!1},_bag:{enumerable:!1}}),this.height=200,this.width=100}var p=require(\"/tris/game/Piece\"),pieces=p.pieces,colors=p.colors,drawBlock=require(\"/tris/game/PieceRenderer\").drawBlock;module.exports=Preview,Preview.prototype={constructor:Preview,draw:function(){for(var e,t,r=this._showNextCt,n=this.bag.preview(r),s=0,i=!1,o=0;r>o;o++){e=pieces[n[o]][0];for(var a=0;5>a;a++){i=!1;for(var l=0;5>l;l++)e[a][l]&&(i||(i=!0,++s),t=\"I\"==n[o]?l-.5:\"O\"==n[o]?l+.5:l,drawBlock(colors[n[o]],t,s,20,20,this.ctx))}++s}return this},clear:function(){return this.ctx.clearRect(0,0,this._w,this._h),this}},Object.defineProperties(Preview.prototype,{bag:{get:function(){return this._bag},set:function(e){if(this._bag)throw Error(\"cannot reset bag\");this._bag=e,e.on(\"next\",function(){this.clear().draw()},this)}},showNext:{get:function(){return this._showNextCt},set:function(e){e=e>3?3:0>e?0:Math.floor(e),this._showNextCt=e},enumerable:!0},height:{get:function(){return this._h},set:function(e){this.canvas.height=this._h=e}},width:{get:function(){return this._w},set:function(e){this.canvas.width=this._w=e}}});","/tris/game/Score":"function Score(){this.rows=0,this.total=0,this.scoring=null,Object.defineProperties(this,{_handles:{value:[],writable:!0},_rowsDisplayed:{value:0,writable:!0},_totalDisplayed:{value:0,writable:!0},_level:{value:0,writable:!0}}),this.ticker=null,this.levelNode=null,this.rowsNode=null,this.totalNode=null}module.exports=Score;var mix=require(\"/tris/Grue/js/object/mix\");mix({set:function(e,t,r,n){var i=this.scoring.line_multipliers[e-1]*(this.level+1)+t+2*r+n;this.total+=i,this.rows+=e,1>=10*this.level/this.rows&&++this.level},init:function(){this.rowsNode.innerHTML=0,this.totalNode.innerHTML=0,this._handles.push(this.ticker.on(\"draw\",function(){this.rows>this._rowsDisplayed&&(++this._rowsDisplayed,this._rowsDisplayed>this.rows&&(this._rowsDisplayed=this.rows),this.rowsNode.innerHTML=this._rowsDisplayed),this.total>this._totalDisplayed&&(this.totalNode.innerHTML=this.total,this._totalDisplayed=this.total)},this).lastRegisteredHandler)},destroy:function(){for(var e=0;this._handles.length>e;e++)this.ticker.off(this._handles[e])}},Score.prototype),Object.defineProperty(Score.prototype,\"level\",{get:function(){return this._level},set:function(e){this._level=e,this.levelNode.innerHTML=e}});","/tris/Grue/js/structures/Dict":"function Dict(){this._arr=[],this._obj=Object.create(null),Object.defineProperties(this,{_arr:{enumerable:!1},_obj:{enumerable:!1}})}module.exports=Dict;var typeOf=require(\"/tris/Grue/js/utils/typeOf\");Dict.prototype.add=function(e){if(\"string\"!=typeof e&&\"number\"!=typeof e)throw TypeError(\"Expected string or number but saw \"+typeOf(e)+\" instead\");this.contains(e)||(this._obj[e]=this._arr.length,this._arr.push(e))},Dict.prototype.remove=function(e){if(this.contains(e)){var t=this._obj[e];delete this._obj[e],this._arr.splice(t,1)}},Dict.prototype.contains=function(e){return e in this._obj},Dict.prototype.toArray=function(){return this._arr.slice(0)},Dict.prototype.sort=function(e){this._arr=this._arr.sort(e);for(var t=0,r=this._arr.length;r>t;t++)this._obj[this._arr[t]]=t},Object.defineProperty(Dict.prototype,\"length\",{get:function(){return this._arr.length},set:function(e){if(\"number\"!=typeof e)throw TypeError(\"Expected length to be a number but saw \"+typeOf(e)+\" instead\");var t=this._arr.slice(e);this._arr.length=e;for(var r=0;t.length>r;r++)delete this._obj[t[r]];return e}});","/tris/game/Board":"function Board(e,t,r,n,i){Component.apply(this),this.__grue_props.use_event_pool=!0,this.canvas=document.createElement(\"canvas\"),this.canvas.setAttribute(\"tabindex\",\"-1\"),this._ctx=this.canvas.getContext(\"2d\"),this._renderer=null,this._piece=null,this._emptyRow=null,this.ticker=e,this._actions=[],this._flashHandle=null,this.reset(t,r,n,i),Object.defineProperties(this,{_piece:{enumerable:!1},_actions:{enumerable:!1},_ctx:{enumerable:!1},_cols:{enumerable:!1},_rows:{enumerable:!1},_field:{enumerable:!1},_dx:{enumerable:!1},_dy:{enumerable:!1},_flashHandle:{enumerable:!1}})}module.exports=Board;var Component=require(\"/tris/Grue/js/infrastructure/Component\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),PieceRenderer=require(\"/tris/game/PieceRenderer\"),Dict=require(\"/tris/Grue/js/structures/Dict\"),mix=require(\"/tris/Grue/js/object/mix\"),Piece=require(\"/tris/game/Piece\"),pieces=Piece.pieces,eachblock=require(\"/tris/game/eachblock\");mix({publishes:Object.create(Component.prototype.publishes,{animating:{value:!0},rowsCleared:{value:!0},outOfBounds:{value:!0}}),reset:function(e,t,r,n){this._ctx.clearRect(0,0,t*r,e*n),this._piece=new Piece(null,r,n),(r!=this._dx||n!=this._dy)&&(this._renderer=new PieceRenderer(Piece.pieces,Piece.colors,r,n)),this._frameCt=0,this._actions.length=0,this.canvas.width=t*r,this.canvas.height=e*n,this._rows=e+2;var i,s=this._emptyRow=Array(t);for(this._cols=t,this._dx=r,this._dy=n,this._field=Array(this._rows),i=0;10>i;i++)s[i]=\"\";for(i=0;this._rows>i;i++)this._field[i]=s.slice(0)},refresh:function(){for(var e=this._dx,t=this._dy,r=this._field,n=this._ctx,i=2,s=this._cols,o=this._rows;o>i;i++)for(var a=0;s>a;a++)r[i][a]?PieceRenderer.drawBlock(Piece.colors[r[i][a]],a,i-2,e,t,n):n.clearRect(a*e,(i-2)*t,e,t)},drawPiece:function(e,t){!t&&this._renderer.clear(this._piece,this._ctx),this._piece.x=e.x,this._piece.y=e.y-2,this._piece.r=e.r,this._piece.name=e.name,this._renderer.draw(e,-2,this._ctx)},isRowFilled:function(e){for(var t=0,r=this._cols;r>t;t++)if(!this._field[e][t])return!1;return!0},maybeClearRows:function(e){var t=[],r={},n=new Dict;eachblock(e.getModel(),e.x,e.y,function(e,n){r[n]||(r[n]=!0,t.push(n))});for(var i=0,s=t.length;s>i;i++)this.isRowFilled(t[i])&&n.add(t[i]);return n.length&&this.clearRows(n),n.length},clearRows:function(e){var t=e.toArray(),r=0;if(!t.length)throw Error(\"No rows to clear\");this.emitEvent(\"animating\",!0);for(var n=0;t.length>n;n++)t[n]-=2;this._flashHandle=this.ticker.on(\"draw\",function(){if(++r,7>r)for(var n=0;t.length>n;n++)this.fadeRow(t[n]);else this._flashHandle.off(),this._removeRows(e),this.emitEvent(\"animating\",!1)},this).lastRegisteredHandler},fadeRow:function(e){this._ctx.fillStyle=\"rgba(255, 255, 255, 0.5)\",this._ctx.fillRect(0,e*this._dy,this._cols*this._dx,this._dy)},_removeRows:function(e){for(var t=Array(this._rows),r=this._rows,n=r;r--;){for(;e.contains(r);)--r;t[--n]=this._field[r]}for(var r=0,i=e.length;i>r;r++)t[r]=this._emptyRow.slice(0);this._field=t,this.refresh()},willIntersect:function(e){for(var t,r,n=e.y,i=e.x,s=e.getModel(),o=0;5>o;o++)for(var a=0;5>a;a++)if(s[o][a]&&(r=i+a,t=n+o,null==this._field[t]||null==this._field[t][r]||this._field[t][r]))return!0;return!1},occupy:function(e){var t=!1,r=e.name;eachblock(e.getModel(),e.x,e.y,function(e,n){return 0>n||n>=this.cols?t=!0:(this._field[n][e]=r,void 0)},this),t&&this.emitEvent(\"outOfBounds\",!0)},toString:function(){return this._field.map(function(e,t){return[t].concat(e.map(function(e){return e?e:\" \"})).join(\"\")}).join(\"\\n\")}},Board.prototype),inherit(Board,Component);","/tris/Grue/js/dom/addClass":"\"undefined\"==typeof GRUE&&require(\"../base/base\"),module.exports=\"function\"==typeof GRUE.has&&GRUE.has(\"dom_classList\")?function(e,t){for(var r=t.split(\" \"),n=0;r.length>n;n++)e.classList.add(r[n]);return e}:function(e,t){if(e.className&&e.className.length)for(var r=\" \"+e.className+\" \",n=t.split(\" \"),i=0;n.length>i;i++)~r.indexOf(\" \"+n[i]+\" \")&&(e.className+=\" \"+n[i]);else e.className=t;return e};","/tris/Grue/js/dom/setAttrProps":"var each=require(\"/tris/Grue/js/functional/each\"),typeOf=require(\"/tris/Grue/js/utils/typeOf\"),mix=require(\"/tris/Grue/js/object/mix\"),addClass=require(\"/tris/Grue/js/dom/addClass\");module.exports=function(e,t){if(t===void 0)return e;if(\"object\"!=typeof t)throw TypeError(\"setAttrProps expects argument 2 to be an object. \"+typeOf(t)+\" passed\");each(t,function(r,n){switch(n.toLowerCase()){case\"style\":\"string\"==typeof t.style?e.style.cssText=t.style:mix(t.style,e.style);break;case\"class\":case\"classname\":addClass(e,r);break;case\"text\":if(\"string\"!=typeof r){if(!(\"toString\"in r))throw TypeError(\"cannot set text from: \"+r);console.warn(\"setAttrProps coercing \"+typeOf(r)+\" to string for use as text content\"),r=\"\"+r}e.appendChild(document.createTextNode(r));break;case\"html\":if(\"string\"!=typeof r){if(!(\"toString\"in r))throw TypeError(\"cannot set innerHTML from: \"+r);console.warn(\"setAttrProps coercing \"+typeOf(r)+\" to string for use as innerHTML\"),r=\"\"+r}e.innerHTML=r;break;case\"type\":e.type=r,e.type!=r&&e.setAttribute(\"type\",r);break;default:e.setAttribute(n,r)}})};","/tris/Grue/js/dom/create":"var setAttrProps=require(\"/tris/Grue/js/dom/setAttrProps\");module.exports=function(e,t){return\"string\"==typeof e&&(e=document.createElement(e),\"button\"==e&&(!t&&(t={}),t.type=\"button\")),null!=t&&\"object\"==typeof t&&setAttrProps(e,t),e};","/tris/game/Dialog":"function Dialog(e){this.dom=null,this.destroyOnHide=!!e&&!!e.destroyOnHide,this._mask=createDom(\"div\",{\"class\":\"dlg-mask\"}),this._onHide=!!e&&e.onHide||null,this._init(e.content),this._isVisible=!1}module.exports=Dialog;var mix=require(\"/tris/Grue/js/object/mix\"),createDom=require(\"/tris/Grue/js/dom/create\"),docEl=document.documentElement,win=window;mix({_init:function(e){if(this.dom)return!0;if(this.dom=createDom(\"div\",{\"class\":\"dlg\",tabindex:\"-1\"}),\"string\"==typeof e)this.dom.innerHTML=e;else{if(null==e||\"number\"!=typeof e.nodeType)throw TypeError(\"Was expecting a string or DOMNode but saw \"+e+\" instead\");this.dom.appendChild(e)}},show:function(){var e=(h=docEl.clientHeight)<window.innerHeight?window.innerHeight:h,t=docEl.scrollHeight+docEl.scrollTop;this._mask.style.height=Math.max(e,t)+\"px\",document.body.style.overflow=\"hidden\",document.body.appendChild(this._mask),document.body.appendChild(this.dom),this.dom.focus(),this._isVisible=!0},hide:function(){this._isVisible=!1,this.dom.blur(),this.dom.parentNode.removeChild(this.dom),this._mask.parentNode.removeChild(this._mask),this._onHide&&this._onHide(this.data),document.body.style.overflow=\"inherit\",this.destroyOnHide&&this.destroy()},destroy:function(){this._isVisible&&this.hide(),delete this.dom,delete this._mask}},Dialog.prototype);","/tris/Grue/js/dom/removeClass":"\"undefined\"==typeof GRUE&&require(\"../base/base\"),module.exports=\"function\"==typeof GRUE.has&&GRUE.has(\"dom_classList\")?function(e,t){for(var r=t.split(\" \"),n=0;r.length>n;n++)e.classList.remove(r[n]);return e}:function(e,t){var r,n,i,s=e.className;if(!s)return e;for(n=t.split(\" \"),i=0,i=0;n.length>i;i++)r=(\" \"+s+\" \").indexOf(\" \"+t+\" \"),r>-1&&(s=s.slice(0,r?r-1:r)+s.slice((r?r:r+1)+t.length));return e.className=s,e};","/tris/game/Options":"function Options(e){e&&(e.content=TMPL)||(e={content:TMPL}),this.data=mix(e.data),this._data=mix(e.data),this._handles=[],Dialog.call(this,e)}module.exports=Options;var Dialog=require(\"/tris/game/Dialog\"),mix=require(\"/tris/Grue/js/object/mix\"),inherit=require(\"/tris/Grue/js/OO/inherit\"),DOMEvents=require(\"/tris/Grue/js/dom/events/DOMEvents\"),addClass=require(\"/tris/Grue/js/dom/addClass\"),removeClass=require(\"/tris/Grue/js/dom/removeClass\"),contains=require(\"/tris/Grue/js/dom/contains\"),TMPL='<h2>Options</h2><label class=\"g_row\">Starting Level: <input type=\"number\" min=\"0\" max=\"30\" name=\"start_level\" /></label><div class=\"g_row\"><span>Up Arrow Turns:</span><label><input type=\"radio\" name=\"up_turns_right\" value=\"false\" /><span>left</span></label> <label><input type=\"radio\" name=\"up_turns_right\" value=\"true\" /><span>right</span></label></div><div><label>Max Speed: <input type=\"text\" name=\"max_speed\" /></label> <small>-1 for default speeds. Speed is frames per row. Levels 0 - 9 are calculated as 48 - (5 * level); levels 10 - 12 default to 5; levels 13 - 15 default to 4; levels 16 and 17 default to 3; levels 18 - 28 default to 2 and 29 and above default to 1.</small></div><div><label><input type=\"checkbox\" name=\"slide_fast\" /> Slide faster?</label></div><div><label><input type=\"checkbox\" name=\"crazy_piece\" /> Use crazy piece?</label></div><div><label><input type=\"checkbox\" name=\"key_entropy\" /> Use key press as entropy source?</label></div><div><label><input type=\"checkbox\" name=\"random_generator\" /> Use \"<a href=\"http://tetrisconcept.net/wiki/Random_Generator\" target=\"_blank\">The Random Generator</a>\"?</label> <label class=\"bag-size hidden\"> Bag Size: <input type=\"number\" name=\"bag_size\" min=\"7\" max=\"63\" value=\"7\" step=\"7\" /></div><div class=\"g_row btns-right\"><button type=\"button\" class=\"btn btn-small cancel-btn\" name=\"cancel\">Cancel</button> <button type=\"button\" class=\"btn btn-small save-btn\" name=\"save\">Save</button>',$=function(e,t){var r,n=(t||document).querySelectorAll(e);if(t){r=[];for(var i=0,s=n.length;s>i;i++)contains(t,n[i])&&r.push(n[i]);return r}return[].slice.apply(n,0)};mix({_init:function(){function e(e){return\"true\"==e}if(!Dialog.prototype._init.apply(this,arguments)){this.dom.className+=\" options-dlg\";for(var t=$('[name=\"start_level\"]',this.dom)[0],r=$('[name=\"up_turns_right\"]',this.dom),n=$('[name=\"slide_fast\"]',this.dom)[0],i=$('[name=\"crazy_piece\"]',this.dom)[0],s=$('[name=\"key_entropy\"]',this.dom)[0],o=$('[name=\"random_generator\"]',this.dom)[0],a=$(\".bag-size\",this.dom)[0],l=$('[name=\"bag_size\"]',a)[0],u=$('[name=\"max_speed\"]',this.dom)[0],c=0;r.length>c;c++)if(e(r[c].value)==this.data.up_turns_right){r[c].checked=!0;break}t.value=this.data.start_level,n.checked=this.data.slide_fast,i.checked=this.data.use_crazy_piece,s.checked=this.data.use_keyboard_entropy,l.value=this.data.bag_size,o.checked=this.data.use_the_random_generator,u.value=this.data.max_speed||-1,this.data.use_the_random_generator&&removeClass(a,\"hidden\"),this._handles.push(DOMEvents.on(o,\"change\",function(){o.checked?removeClass(a,\"hidden\"):addClass(a,\"hidden\")})),this._handles.push(DOMEvents.on(this.dom,\"click\",function(a){var c=a.target,h=c.nodeName.toLowerCase();if(\"button\"==h){if(\"save\"==c.name){for(var p=0;r.length>p;p++)r[p].checked&&(this.data.up_turns_right=e(r[p].value));this.data.start_level=Math.min(30,+t.value),this.data.slide_fast=n.checked,this.data.use_crazy_piece=i.checked,this.data.use_the_random_generator=o.checked,this.data.bag_size=+l.value,this.data.use_keyboard_entropy=s.checked,this.data.max_speed=+u.value}else this.data=this._data;this.hide()}},!1,this))}},destroy:function(){for(var e=0;this._handles.length>e;e++)DOMEvents.off(this._handles[e]);delete this.data,Dialog.prototype.destroy.apply(this,arguments)}},Options.prototype),inherit(Options,Dialog);","/tris/properties":"module.exports={controls:{rotate_left:68,rotate_right:70,left:37,right:39,soft_drop:40,hard_drop:32,play_toggle:80,up_turns_right:!1},scoring:{line_multipliers:[40,100,300,800],soft_drop:1,hard_drop:2},cellsize:25,cols:10,rows:20,preview:{show:3},start_level:5,slide_fast:!1,use_crazy_piece:!1,use_keyboard_entropy:!1,use_the_random_generator:!0,bag_size:7,max_speed:-1};","/tris/Grue/js/functional/bindRight":"module.exports=function(e,t){var r=[].slice.call(arguments,2),n=e.length;return n?function(){var i=[].slice.call(arguments,0),s=0;if(n>i.length+r.length)for(s=n-(n-i.length+r.length);s--;)i.push(null);else i.length+r.length>n&&(i.length=n-r.length);return e.apply(t,i.concat(r))}:function(){return e.apply(t,[].concat.call(arguments,r))}};","/tris/Grue/js/object/merge":"var bindRight=require(\"/tris/Grue/js/functional/bindRight\"),mix=require(\"/tris/Grue/js/object/mix\");module.exports=bindRight(mix,null,!0);","/tris/index":"function useKeypress(){keypressHandle=DOMEvents.on(document,\"keydown\",function(){entropy.push(now())},!1)}function dontUseKeypress(){keypressHandle&&DOMEvents.off(keypressHandle),keypressHandle=null}var hasLS=\"localStorage\"in window&&null!=window.localStorage,Piece=require(\"/tris/game/Piece\"),Ticker=require(\"/tris/Grue/js/dom/anim/Ticker\"),Bag=Piece.Bag,Game=require(\"/tris/game/Game\"),Preview=require(\"/tris/game/Preview\"),Score=require(\"/tris/game/Score\"),Board=require(\"/tris/game/Board\"),Options=require(\"/tris/game/Options\"),DOMEvents=require(\"/tris/Grue/js/dom/events/DOMEvents\"),PROPS=require(\"/tris/properties\"),genFnFactory=require(\"/tris/game/defaultPieceGenerator\"),random=require(\"/tris/Grue/js/number/random\"),merge=require(\"/tris/Grue/js/object/merge\"),props=function(){var e=localStorage.getItem(\"props\");return e?(e=JSON.parse(e),merge(PROPS,e,!0)):e=PROPS,e}(),layout=function(){var e=document.getElementsByClassName(\"root\")[0];return{root:e,preview:e.getElementsByClassName(\"preview\")[0],playfield:e.getElementsByClassName(\"playfield\")[0],scoreboard:e.getElementsByClassName(\"scoreboard\")[0]}}(),ticker=new Ticker,entropy=[],defaultPieceNames=\"ITSZJLO\",extendedPieceNames=\"ITSZJLOR\",randomGenFnGen=function(e,t){return function(){for(var r,s=Array(14),n=e.length,i=0;14>i;i++){do r=t&&t.length>14?t.pop()%n:random(n-1);while(\"R\"==e.charAt(r)&&2!=random(3));s[i]=e.charAt(r)}return s}},getGenFnToUse=function(){return props.use_keyboard_entropy?!keypressHandle&&useKeypress():keypressHandle&&dontUseKeypress(),props.use_the_random_generator?genFnFactory(props.use_crazy_piece?extendedPieceNames:defaultPieceNames,props.use_keyboard_entropy&&entropy):randomGenFnGen(props.use_crazy_piece?extendedPieceNames:defaultPieceNames,props.use_keyboard_entropy&&entropy)},bag=new Bag(getGenFnToUse()),game=new Game,preview=new Preview,now=Date.now||function(){return+new Date},each=require(\"/tris/Grue/js/functional/each\"),showOptions=function(){var e=this._state.playing;e&&this.togglePlay(),new Options({data:{up_turns_right:this.props.controls.up_turns_right,start_level:this.props.start_level,slide_fast:this.props.slide_fast,use_crazy_piece:this.props.use_crazy_piece,use_keyboard_entropy:this.props.use_keyboard_entropy,use_the_random_generator:this.props.use_the_random_generator,bag_size:this.props.bag_size,max_speed:this.props.max_speed||-1},destroyOnHide:!0,onHide:function(t){var r=this.props.start_level!=t.start_level,s=this.props.use_keyboard_entropy!=t.use_keyboard_entropy||this.props.use_the_random_generator!=t.use_the_random_generator||this.props.use_crazy_piece!=t.use_crazy_piece;each(t,function(e,t){t in this.props&&(this.props[t]=e)},this),t.up_turns_right!=this.props.controls.up_turns_right&&(this.props.controls.up_turns_right=t.up_turns_right,this.keyMap[38]=this.props.controls.up_turns_right?Game.ACTIONS.rotate_right:Game.ACTIONS.rotate_left),this.props.slide_fast=t.slide_fast,this.props.max_speed=t.max_speed,bag.size=t.bag_size,s&&(bag.generator=getGenFnToUse(),bag.reset()),r?this.reset():e&&this.togglePlay(),this.props._user_configured||(this.props._user_configured=!0),localStorage.setItem(\"props\",JSON.stringify(this.props))}.bind(this)}).show()}.bind(game),keypressHandle;DOMEvents.on(layout.root,\"click\",function(e){var t=e.target,r=t.nodeName.toLowerCase();\"button\"==r&&(\"toggle\"==t.name?this.togglePlay():\"new\"==t.name?this.newGame():\"options\"==t.name&&showOptions())},!1,game),bag.size=props.bag_size,preview.bag=bag,layout.preview.appendChild(preview.canvas),preview.showNext=props.preview.show,game.layout=layout,game.props=props,game.bag=bag,game.preview=preview,game.ticker=ticker,game.boardCtor=Board,game.scoreCtor=Score,game.init(),props._user_configured||showOptions();"},"__ordered":["/tris/Grue/js/utils/ids","/tris/Grue/js/base/Grue","/tris/Grue/js/utils/types","/tris/Grue/js/utils/typeOf","/tris/Grue/js/object/mix","/tris/Grue/js/OO/inherit","/tris/Grue/js/string/ucfirst","/tris/Grue/js/infrastructure/GrueEvent","/tris/Grue/js/infrastructure/GruePooledEvent","/tris/Grue/js/vendor/setImmediate/setImmediate","/tris/Grue/js/infrastructure/EventEmitter","/tris/Grue/js/number/random","/tris/Grue/js/object/map","/tris/Grue/js/functional/map","/tris/Grue/js/string/repeat","/tris/game/defaultPieceGenerator","/tris/game/eachblock","/tris/game/Piece","/tris/Grue/js/dom/requestAnimationFramePolyfill","/tris/Grue/js/dom/anim/Ticker","/tris/Grue/js/functional/each","/tris/Grue/js/string/iter","/tris/Grue/js/functional/filter","/tris/Grue/js/dom/isHostMethodOrProperty","/tris/Grue/js/object/copy","/tris/Grue/js/infrastructure/Observable","/tris/Grue/js/array/indexOf","/tris/Grue/js/infrastructure/ComponentNode","/tris/Grue/js/infrastructure/utils/ownPropConfig","/tris/Grue/js/infrastructure/Component","/tris/Grue/js/dom/events/isEventSupported","/tris/Grue/js/dom/contains","/tris/Grue/js/dom/events/bind","/tris/Grue/js/dom/events/unbind","/tris/Grue/js/base/has/qsa","/tris/Grue/js/string/hyphenToCamel","/tris/Grue/js/dom/matches","/tris/Grue/js/dom/events/DOMEvents","/tris/game/Game","/tris/game/PieceRenderer","/tris/game/Preview","/tris/game/Score","/tris/Grue/js/structures/Dict","/tris/game/Board","/tris/Grue/js/dom/addClass","/tris/Grue/js/dom/setAttrProps","/tris/Grue/js/dom/create","/tris/game/Dialog","/tris/Grue/js/dom/removeClass","/tris/game/Options","/tris/properties","/tris/Grue/js/functional/bindRight","/tris/Grue/js/object/merge","/tris/index"],"__":"/tris/index"};